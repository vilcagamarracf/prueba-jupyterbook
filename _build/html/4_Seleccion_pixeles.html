
<!DOCTYPE html>


<html lang="es" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>4. Selección de pixeles &#8212; Prueba de tesis con jupyterbook</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=384b581d" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script src="_static/documentation_options.js?v=78d55cf8"></script>
    <script src="_static/doctools.js?v=888ff710"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=efea14e4"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script src="_static/translations.js?v=efdbd0b9"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=36754332"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = '4_Seleccion_pixeles';</script>
    <link rel="icon" href="_static/favicon.png"/>
    <link rel="index" title="Índice" href="genindex.html" />
    <link rel="search" title="Búsqueda" href="search.html" />
    <link rel="next" title="5. Balance de Energía Superficial - Modelo METRIC" href="5_Modelo_METRIC.html" />
    <link rel="prev" title="3. Sección iterativa y parámetro H" href="3_H_Desarrollo.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="es"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Saltar al contenido principal</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="README.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/favicon.png" class="logo__image only-light" alt="Prueba de tesis con jupyterbook - Home"/>
    <script>document.write(`<img src="_static/favicon.png" class="logo__image only-dark" alt="Prueba de tesis con jupyterbook - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Búsqueda" aria-label="Búsqueda" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Búsqueda</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="README.html">
                    Aplicación del Modelo METRIC en cultivos de arroz
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Desarrollo</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="1_Explorar_imagenes_local.html">1. Visualizando imágenes</a></li>
<li class="toctree-l1"><a class="reference internal" href="2_Exploracion_datos_estacion.html">2. Visualización de datos de estación meteorológica</a></li>
<li class="toctree-l1"><a class="reference internal" href="3_H_Desarrollo.html">3. Sección iterativa y parámetro H</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">4. Selección de pixeles</a></li>
<li class="toctree-l1"><a class="reference internal" href="5_Modelo_METRIC.html">5. Balance de Energía Superficial - Modelo METRIC</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">


<a href="https://github.com/vilcagamarracf/Inv_arroz_METRIC" target="_blank"
   class="btn btn-sm btn-source-repository-button"
   title="Repositorio de origen"
   data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>

</a>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Descarga esta pagina">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/4_Seleccion_pixeles.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Descargar archivo fuente"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Imprimir en PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Modo de pantalla completa"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="claro/oscuro" aria-label="claro/oscuro" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Búsqueda" aria-label="Búsqueda" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Selección de pixeles</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contenido </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#inicio">4.1. Inicio</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#funcion">4.2. Función</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#procesamiento">4.3. Procesamiento</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#revisando-datos">4.3.1. Revisando datos</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#funcion-recorte-por-percentiles">4.3.2. Función <code class="docutils literal notranslate"><span class="pre">recorte_por_percentiles</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#pixeles-frios">4.3.3. Pixeles Fríos</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#pixeles-calientes">4.3.4. Pixeles Calientes</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#pruebas">4.3.5. Pruebas</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#graficas">4.3.6. Gráficas</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <hr class="docutils" />
<p> Libreta n° 4 sobre el trabajo de investigación: </p>
<center>
<p> 
    <b> "Estimación de la evapotranspiración espacio-temporal en arrozales usando imágenes satelitales, Departamento de Lambayeque" 
    </b>
</p>
</center>
<p>Autor: Cesar Francisco Vilca Gamarra</p>
<p>Repositorio alojado en <a class="reference external" href="https://github.com/vilcagamarracf/Inv_arroz_METRIC">GitHub</a></p>
<p>Marzo, 2022</p>
<hr class="docutils" />
<section id="seleccion-de-pixeles">
<h1><span class="section-number">4. </span>Selección de pixeles<a class="headerlink" href="#seleccion-de-pixeles" title="Link to this heading">#</a></h1>
<p><strong>Referencia</strong></p>
<ul class="simple">
<li><p>Bhattarai, N., Quackenbush, L. J., Im, J., &amp; Shaw, S. B. (2017). A new optimized algorithm for automating endmember pixel selection in the SEBAL and METRIC models. <em>Remote Sensing of Environment</em>, 196, 178-192. <a class="reference external" href="http://dx.doi.org/10.1016/j.rse.2017.05.009">10.1016/j.rse.2017.05.009</a></p></li>
</ul>
<p><strong>Selección de pixeles fríos y calientes</strong></p>
<ul class="simple">
<li><p>In terms of identifying a cold pixel, the search method seeks to find
the coldest pixels with the highest NDVI. There is not necessarily one
pixel that has both the lowest Ts and the highest NDVI. Thus, instead
of searching for a single pixel, the method searches for a subset of pixels that have both low NDVI and high Ts.</p></li>
<li><p>Specifically, the cold pixel selection process starts by searching for <strong>pixels that have a Ts value within the lowest n1% (e.g. n1 = 1) of the Ts histogram</strong> and NDVI values in
the top n2% (e.g. n2 = 1) of the NDVI histogram.</p></li>
<li><p>The search continues by increasing the value of n2 first (i.e. increasing n2 in increments of 1 up to 10, keeping n1 = 1) and then increasing n1 (up to 10 in increments of 1) until 10 pixels are identified.</p></li>
</ul>
<section id="inicio">
<h2><span class="section-number">4.1. </span>Inicio<a class="headerlink" href="#inicio" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ------------------------------------------------</span>
<span class="c1"># Importando librerías utilizadas</span>
<span class="c1"># ------------------------------------------------</span>

<span class="kn">import</span> <span class="nn">ee</span>
<span class="n">ee</span><span class="o">.</span><span class="n">Initialize</span><span class="p">()</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>

<span class="kn">import</span> <span class="nn">geemap</span>
<span class="kn">import</span> <span class="nn">geemap.colormaps</span> <span class="k">as</span> <span class="nn">cmp</span> <span class="c1"># Paletas para visualización de imágenes</span>

<span class="c1"># Funciones en archivo Funciones.py</span>
<span class="kn">from</span> <span class="nn">funciones</span> <span class="kn">import</span> <span class="o">*</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ModuleNotFoundError</span><span class="g g-Whitespace">                       </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">line</span> <span class="mi">5</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="c1"># ------------------------------------------------</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="c1"># Importando librerías utilizadas</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="c1"># ------------------------------------------------</span>
<span class="ne">----&gt; </span><span class="mi">5</span> <span class="kn">import</span> <span class="nn">ee</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span> <span class="n">ee</span><span class="o">.</span><span class="n">Initialize</span><span class="p">()</span>
<span class="g g-Whitespace">      </span><span class="mi">8</span> <span class="kn">import</span> <span class="nn">os</span>

<span class="ne">ModuleNotFoundError</span>: No module named &#39;ee&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ------------------------------------------------------------------------------------------------</span>
<span class="c1"># Pruebas: En caso de realizar alguna edición al archivo &#39;funciones.py&#39; realizar lo siguiente:</span>
<span class="c1"># ------------------------------------------------------------------------------------------------</span>

<span class="c1"># import importlib </span>
<span class="c1"># import sys</span>

<span class="c1"># importlib.reload(sys.modules[&#39;funciones&#39;]) # Importa las funciones del archivo con las modificaciones aplicadas</span>
<span class="c1"># from funciones import *    </span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ------------------------------------------------</span>
<span class="c1"># Importando áreas de estudio</span>
<span class="c1"># ------------------------------------------------</span>

<span class="c1"># Importar asset público: Distrito de Ferreñafe</span>
<span class="n">asset_dist</span> <span class="o">=</span> <span class="n">ee</span><span class="o">.</span><span class="n">FeatureCollection</span><span class="p">(</span><span class="s1">&#39;users/CesarVilca/distritos&#39;</span><span class="p">)</span>
<span class="n">dist_fcol</span> <span class="o">=</span> <span class="n">asset_dist</span><span class="o">.</span><span class="n">filterMetadata</span><span class="p">(</span><span class="s1">&#39;DISTRITO&#39;</span><span class="p">,</span> <span class="s1">&#39;equals&#39;</span><span class="p">,</span> <span class="s1">&#39;FERREÑAFE&#39;</span><span class="p">)</span>
<span class="n">roi</span> <span class="o">=</span> <span class="n">dist_fcol</span><span class="o">.</span><span class="n">geometry</span><span class="p">()</span><span class="o">.</span><span class="n">bounds</span><span class="p">()</span>   <span class="c1"># ee.Geometry tipo caja</span>

<span class="c1"># Importar shapefile de Áreas voladas (archivo en local)</span>
<span class="n">ruta_ferrenafe</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;input/Ferreñafe_areas_2.shp&#39;</span>

<span class="c1"># Lectura como FeatureCollection con geemap</span>
<span class="n">predios_agricolas</span> <span class="o">=</span> <span class="n">geemap</span><span class="o">.</span><span class="n">shp_to_ee</span><span class="p">(</span><span class="n">ruta_ferrenafe</span><span class="p">)</span>
<span class="n">predios_vis</span> <span class="o">=</span> <span class="n">ee</span><span class="o">.</span><span class="n">Image</span><span class="p">()</span><span class="o">.</span><span class="n">paint</span><span class="p">(</span><span class="n">predios_agricolas</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>  <span class="c1"># Ver solo bordes, no relleno</span>

<span class="n">predios_bound</span> <span class="o">=</span> <span class="n">predios_agricolas</span><span class="o">.</span><span class="n">geometry</span><span class="p">()</span><span class="o">.</span><span class="n">bounds</span><span class="p">()</span>
<span class="n">predios_bound_vis</span> <span class="o">=</span> <span class="n">ee</span><span class="o">.</span><span class="n">Image</span><span class="p">()</span><span class="o">.</span><span class="n">paint</span><span class="p">(</span><span class="n">predios_bound</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># Ver solo bordes, no relleno</span>

<span class="c1"># type(predios_agricolas) # Comprobación</span>

<span class="c1"># ------------------------------------------------</span>
<span class="c1"># Parámetros de visualización de mapas con geemap</span>
<span class="c1"># ------------------------------------------------</span>

<span class="c1"># Para imágenes Landsat 8 y 9 TOA</span>
<span class="n">vis_rgb</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;min&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span> <span class="s1">&#39;max&#39;</span><span class="p">:</span> <span class="mf">0.3</span><span class="p">,</span> <span class="s1">&#39;bands&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;B4&#39;</span><span class="p">,</span> <span class="s1">&#39;B3&#39;</span><span class="p">,</span> <span class="s1">&#39;B2&#39;</span><span class="p">]}</span>

<span class="c1"># Paletas de colores</span>
<span class="n">albedo_cmap</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;68181f&#39;</span><span class="p">,</span> <span class="s1">&#39;d6604d&#39;</span><span class="p">,</span> <span class="s1">&#39;f9dbc7&#39;</span><span class="p">,</span> <span class="s1">&#39;d1e5f0&#39;</span><span class="p">,</span> <span class="s1">&#39;2166ac&#39;</span><span class="p">,</span> <span class="s1">&#39;053061&#39;</span><span class="p">]</span>  <span class="c1"># 0 - 0.5</span>
<span class="n">ndvi_cmap</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;ffffff&#39;</span><span class="p">,</span> <span class="s1">&#39;ce7e45&#39;</span><span class="p">,</span> <span class="s1">&#39;fad163&#39;</span><span class="p">,</span> <span class="s1">&#39;74a909&#39;</span><span class="p">,</span> <span class="s1">&#39;3a7405&#39;</span><span class="p">,</span> <span class="s1">&#39;1a3b03&#39;</span><span class="p">]</span>  <span class="c1"># -0.2 - 1  &#39;0048fb&#39;,</span>
<span class="n">ts_cmap</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;fefccc&#39;</span><span class="p">,</span> <span class="s1">&#39;fbd976&#39;</span><span class="p">,</span> <span class="s1">&#39;f08c39&#39;</span><span class="p">,</span> <span class="s1">&#39;ea4a33&#39;</span><span class="p">,</span> <span class="s1">&#39;e43d32&#39;</span><span class="p">,</span> <span class="s1">&#39;812026&#39;</span><span class="p">]</span>  <span class="c1"># 280 - 330 en K o 6.85 - 56.85 en °C</span>
<span class="n">rn_cmp</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;560e0d&#39;</span><span class="p">,</span> <span class="s1">&#39;fd5903&#39;</span><span class="p">,</span> <span class="s1">&#39;fbfe04&#39;</span><span class="p">,</span> <span class="s1">&#39;3aff01&#39;</span><span class="p">,</span> <span class="s1">&#39;01feef&#39;</span><span class="p">,</span> <span class="s1">&#39;0000fe&#39;</span><span class="p">,</span> <span class="s1">&#39;fd6dfd&#39;</span><span class="p">,</span> <span class="s1">&#39;ffffff&#39;</span><span class="p">]</span>
<span class="n">rn_cmp_r</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;ffffff&#39;</span><span class="p">,</span> <span class="s1">&#39;fd6dfd&#39;</span><span class="p">,</span> <span class="s1">&#39;0000fe&#39;</span><span class="p">,</span> <span class="s1">&#39;01feef&#39;</span><span class="p">,</span> <span class="s1">&#39;3aff01&#39;</span><span class="p">,</span> <span class="s1">&#39;fbfe04&#39;</span><span class="p">,</span> <span class="s1">&#39;fd5903&#39;</span><span class="p">,</span> <span class="s1">&#39;560e0d&#39;</span><span class="p">]</span>

<span class="c1"># -------------------------------------------------------</span>
<span class="c1"># Parámetros de visualización de gráficas con matplotlib</span>
<span class="c1"># -------------------------------------------------------</span>

<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.family&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;serif&#39;</span>  <span class="c1">#&#39;serif&#39;, &#39;Arial&#39;  # default es &#39;sans-serif&#39;</span>
<span class="c1"># plt.rcParams[&#39;font.family&#39;] = &#39;Times New Roman&#39;</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;xtick.labelsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">12</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;ytick.labelsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">12</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;axes.titlesize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">14</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;axes.labelsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">12</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.dpi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">72</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="funcion">
<h2><span class="section-number">4.2. </span>Función<a class="headerlink" href="#funcion" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">getRadiacionNeta</span><span class="p">(</span><span class="n">img_ee</span><span class="p">,</span> <span class="n">roi</span><span class="p">,</span> <span class="n">dem</span><span class="p">,</span> <span class="n">lai_method</span><span class="p">,</span> <span class="n">albedo_method</span><span class="p">,</span> <span class="n">HR</span><span class="p">):</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;Obtener mapa de Radiación Neta</span>

<span class="sd">    Parametros</span>
<span class="sd">    ----------</span>
<span class="sd">    img_ee : ee.Image</span>
<span class="sd">    roi : ee.Geometry</span>
<span class="sd">    dem : ee.Image</span>

<span class="sd">    Retorna</span>
<span class="sd">    -------</span>
<span class="sd">    R_n : ee.Image</span>
<span class="sd">    img_sr_tasumi : ee.Image</span>
<span class="sd">    img_productos : ee.Image</span>
<span class="sd">    d2 : ee.Number</span>
<span class="sd">    doy : ee.Number</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># =================================================================</span>
    <span class="c1"># Constantes</span>
    <span class="c1"># =================================================================</span>
    
    <span class="c1"># Factor de conversión de grados a radianes</span>
    <span class="n">factor_rad</span> <span class="o">=</span> <span class="n">ee</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">)</span>

    <span class="c1"># Fechas</span>
    <span class="n">img_date</span> <span class="o">=</span> <span class="n">img_ee</span><span class="o">.</span><span class="n">date</span><span class="p">()</span> <span class="c1"># ee.Date</span>
    <span class="n">doy</span> <span class="o">=</span> <span class="n">img_date</span><span class="o">.</span><span class="n">getRelative</span><span class="p">(</span><span class="s1">&#39;day&#39;</span><span class="p">,</span> <span class="s1">&#39;year&#39;</span><span class="p">)</span> <span class="c1"># ee.Number</span>
    <span class="n">fecha</span> <span class="o">=</span> <span class="n">img_date</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;YYYY-MM-dd&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">getInfo</span><span class="p">()</span> <span class="c1"># string</span>

    <span class="c1"># =================================================================</span>
    <span class="c1"># Procesamiento</span>
    <span class="c1"># =================================================================</span>

    <span class="c1"># Procesar imagen RAW a TOA</span>
    <span class="n">img_toa</span> <span class="o">=</span> <span class="n">convert_RAW_to_TOA</span><span class="p">(</span><span class="n">img_ee</span><span class="p">)</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">roi</span><span class="p">)</span> <span class="c1"># ee.Image</span>
    
    <span class="c1"># Índices de vegetación (eq. 23, 19 y 18)</span>
    <span class="n">img_ndvi</span> <span class="o">=</span> <span class="n">get_ndvi_L8</span><span class="p">(</span><span class="n">img_toa</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">lai_method</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">img_savi</span> <span class="o">=</span> <span class="n">get_savi_L8</span><span class="p">(</span><span class="n">img_toa</span><span class="p">,</span> <span class="n">L</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
        <span class="n">img_lai</span>  <span class="o">=</span> <span class="n">get_lai_L8</span><span class="p">(</span><span class="n">img_savi</span><span class="p">)</span>
        
    <span class="k">if</span> <span class="n">lai_method</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">img_savi</span> <span class="o">=</span> <span class="n">get_savi_L8</span><span class="p">(</span><span class="n">img_toa</span><span class="p">,</span> <span class="n">L</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">img_lai</span>  <span class="o">=</span> <span class="n">get_lai_L8</span><span class="p">(</span><span class="n">img_savi</span><span class="p">)</span>
    
    <span class="c1"># Obtener LAI mediante relación NDVI - IAF</span>
    <span class="k">if</span> <span class="n">lai_method</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">img_savi</span> <span class="o">=</span> <span class="n">get_savi_L8</span><span class="p">(</span><span class="n">img_toa</span><span class="p">)</span> 
        <span class="n">img_lai</span> <span class="o">=</span> <span class="n">img_ndvi</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="mf">2.1362</span><span class="p">)</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="mf">0.0869</span><span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s1">&#39;LAI&#39;</span><span class="p">)</span> <span class="c1"># Usando 10 datos (1 fecha - excel de Martin)</span>
        
    <span class="k">if</span> <span class="n">lai_method</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">img_savi</span> <span class="o">=</span> <span class="n">get_savi_L8</span><span class="p">(</span><span class="n">img_toa</span><span class="p">)</span> 
        <span class="n">img_lai</span> <span class="o">=</span> <span class="n">img_ndvi</span><span class="o">.</span><span class="n">expression</span><span class="p">(</span><span class="s1">&#39;(2.3523*img_ndvi)**2 - 1.9013*img_ndvi + 1.7714&#39;</span><span class="p">,</span> 
                                      <span class="p">{</span><span class="s1">&#39;img_ndvi&#39;</span><span class="p">:</span> <span class="n">img_ndvi</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;NDVI&#39;</span><span class="p">)}</span>
                                      <span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s1">&#39;LAI&#39;</span><span class="p">)</span> <span class="c1"># Usando 30 datos</span>

    <span class="n">img_lai</span> <span class="o">=</span> <span class="n">img_lai</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">img_lai</span><span class="o">.</span><span class="n">lte</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
    
    <span class="c1"># A partir del DEM: Pendiente y Aspect [rad]</span>
    <span class="n">img_dem_clippped</span> <span class="o">=</span> <span class="n">dem</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">roi</span><span class="p">)</span>
    <span class="n">img_slopes</span> <span class="o">=</span> <span class="n">ee</span><span class="o">.</span><span class="n">Terrain</span><span class="o">.</span><span class="n">slope</span><span class="p">(</span><span class="n">img_dem_clippped</span><span class="p">)</span> <span class="c1"># grados</span>
    <span class="n">img_slopes_rad</span> <span class="o">=</span> <span class="n">img_slopes</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">factor_rad</span><span class="p">)</span>  <span class="c1"># ee.Image, radianes </span>
        
    <span class="n">img_aspect</span> <span class="o">=</span> <span class="n">ee</span><span class="o">.</span><span class="n">Terrain</span><span class="o">.</span><span class="n">aspect</span><span class="p">(</span><span class="n">img_dem_clippped</span><span class="p">)</span> <span class="c1"># grados</span>
    <span class="n">img_aspect_rad</span> <span class="o">=</span> <span class="n">img_aspect</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">factor_rad</span><span class="p">)</span>  <span class="c1"># ee.Image, radianes</span>


    <span class="c1"># Ángulos Declinación, Latitud y Horario [rad]</span>
    <span class="n">angle_decl</span><span class="p">,</span> <span class="n">latitud</span><span class="p">,</span> <span class="n">angle_hra</span> <span class="o">=</span> <span class="n">get_decl_lat_hra</span><span class="p">(</span><span class="n">img_ee</span><span class="p">,</span> <span class="n">roi</span><span class="p">,</span> <span class="n">doy</span><span class="p">)</span>


    <span class="c1"># Parámetro: Emisividad e_0 (eq. 17)</span>
    <span class="n">e_nb</span><span class="p">,</span> <span class="n">e_0</span> <span class="o">=</span> <span class="n">get_emisividades</span><span class="p">(</span><span class="n">img_ndvi</span><span class="p">,</span> <span class="n">img_lai</span><span class="p">)</span>

    <span class="c1"># =================================================================</span>
    <span class="c1"># Parámetro: Radiación de onda corta entrante </span>
    <span class="c1"># =================================================================</span>
    
    <span class="c1"># Requiere: t_sw, d2, cos_theta_rel </span>
    <span class="c1"># t_sw requiere: P_air, w, cos_theta_hor</span>
    <span class="c1"># w requiere: e_s</span>

    <span class="c1"># 1. d2 INVERSE RELATIVE DISTANCE EARTH-SUN (eq. 9)</span>
    <span class="n">d2</span> <span class="o">=</span> <span class="n">ee</span><span class="o">.</span><span class="n">Number</span><span class="o">.</span><span class="n">expression</span><span class="p">(</span><span class="s1">&#39;1/( 1+0.033*cos(doy*2*pi/365) )&#39;</span><span class="p">,</span>
                              <span class="p">{</span><span class="s1">&#39;doy&#39;</span><span class="p">:</span> <span class="n">doy</span><span class="p">,</span> <span class="s1">&#39;pi&#39;</span><span class="p">:</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">})</span>

    <span class="c1"># 2. cos_theta_rel [rad] (eq. 7)</span>
    <span class="n">cos_theta_rel</span> <span class="o">=</span> <span class="n">get_cos_theta</span><span class="p">(</span><span class="n">angle_decl</span><span class="p">,</span> 
                                  <span class="n">latitud</span><span class="p">,</span> 
                                  <span class="n">angle_hra</span><span class="p">,</span> 
                                  <span class="n">img_slopes_rad</span><span class="p">,</span> 
                                  <span class="n">img_aspect_rad</span><span class="p">)</span>

    <span class="c1"># 3. t_sw (eq. 4)</span>
    <span class="c1"># 3.1. P_air Atmospheric Pressure [kPa] (eq. 5)</span>
    <span class="n">P_air</span> <span class="o">=</span> <span class="n">dem</span><span class="o">.</span><span class="n">expression</span><span class="p">(</span><span class="s1">&#39;101.3*( (293-0.0065*z)/293 )**5.26&#39;</span><span class="p">,</span> 
                           <span class="p">{</span><span class="s1">&#39;z&#39;</span><span class="p">:</span> <span class="n">dem</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="mi">0</span><span class="p">)})</span> <span class="c1"># ee.Image</span>

    <span class="c1"># 3.2. cos_theta_hor (eq. 8)</span>
    <span class="n">cos_theta_hor</span> <span class="o">=</span> <span class="n">get_cos_theta</span><span class="p">(</span><span class="n">angle_decl</span><span class="p">,</span> 
                                  <span class="n">latitud</span><span class="p">,</span> 
                                  <span class="n">angle_hra</span><span class="p">,</span> 
                                  <span class="n">slope_rad</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> 
                                  <span class="n">aspect_rad</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    
    <span class="c1"># 3.3. w Water in the atmosphere [mm]</span>
    <span class="c1"># 3.3.1. Temperatura de superficie (eq. 20)</span>
    <span class="n">ts</span> <span class="o">=</span> <span class="n">get_surface_temp</span><span class="p">(</span><span class="n">img_toa</span><span class="p">,</span> <span class="n">e_nb</span><span class="p">)</span>      <span class="c1"># [K]</span>
    <span class="n">ts_c</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="mf">273.15</span><span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s1">&#39;Ts_c&#39;</span><span class="p">)</span> <span class="c1"># [°C]</span>

    <span class="c1"># 3.3.2. Near-surface vapor pressure ea [kPa]</span>
    <span class="c1"># Ojo temperatura se requiere en °C</span>
    <span class="c1"># e0_eq = &#39;6.112*exp(17.67*t / (t + 243.5))&#39; # https://www.weather.gov/media/epz/wxcalc/vaporPressure.pdf</span>
    <span class="n">e0_eq</span> <span class="o">=</span> <span class="s1">&#39;0.6108*exp(17.27*t / (t + 237.3))&#39;</span> <span class="c1"># FAO 56, Allen (2012) https://www.fao.org/3/x0490s/x0490s01.pdf</span>
    <span class="n">e0</span> <span class="o">=</span> <span class="n">ts_c</span><span class="o">.</span><span class="n">expression</span><span class="p">(</span><span class="n">e0_eq</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;t&#39;</span><span class="p">:</span> <span class="n">ts_c</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;Ts_c&#39;</span><span class="p">)})</span>
    <span class="n">ea</span> <span class="o">=</span> <span class="n">e0</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">HR</span><span class="o">/</span><span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s1">&#39;vapor_pressure&#39;</span><span class="p">)</span>

    <span class="c1"># 3.3.3. Agua precipitable en la atmósfera w [mm] Garrison &amp; Adler (1990)</span>
    <span class="n">w</span> <span class="o">=</span> <span class="n">ea</span><span class="o">.</span><span class="n">expression</span><span class="p">(</span><span class="s1">&#39;0.14*ea*P + 2.1&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;ea&#39;</span><span class="p">:</span><span class="n">ea</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">:</span><span class="n">P_air</span><span class="p">})</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
    
    <span class="c1"># 3.3.4. t_sw: broad-band atmospheric transmissivity (eq. 4), ASCE-EWRI (2005)</span>
    <span class="n">t_sw</span> <span class="o">=</span> <span class="n">P_air</span><span class="o">.</span><span class="n">expression</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">                            0.35 + 0.627*exp(</span>
<span class="s1">                            - 0.00146*P_air/(Kt*cos_theta_hor) </span>
<span class="s1">                            - 0.075*(W/cos_theta_hor)**0.4</span>
<span class="s1">                            )</span>
<span class="s1">                            &#39;&#39;&#39;</span><span class="p">,</span>
                            <span class="p">{</span><span class="s1">&#39;P_air&#39;</span><span class="p">:</span><span class="n">P_air</span><span class="p">,</span> <span class="s1">&#39;Kt&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;cos_theta_hor&#39;</span><span class="p">:</span><span class="n">cos_theta_hor</span><span class="p">,</span> <span class="s1">&#39;W&#39;</span><span class="p">:</span><span class="n">w</span><span class="p">}</span>
                            <span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s1">&#39;t_sw&#39;</span><span class="p">)</span>
    
    <span class="c1"># Finalmente: R_s_incoming (eq. 3)</span>
    <span class="n">R_s_in</span> <span class="o">=</span> <span class="n">cos_theta_rel</span><span class="o">.</span><span class="n">expression</span><span class="p">(</span><span class="s1">&#39;1367*cos_theta_rel*t_sw/d2&#39;</span><span class="p">,</span>
                                      <span class="p">{</span><span class="s1">&#39;cos_theta_rel&#39;</span><span class="p">:</span><span class="n">cos_theta_rel</span><span class="p">,</span> <span class="s1">&#39;t_sw&#39;</span><span class="p">:</span><span class="n">t_sw</span><span class="p">,</span> <span class="s1">&#39;d2&#39;</span><span class="p">:</span><span class="n">d2</span><span class="p">}</span>
                                      <span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s1">&#39;R_s_in&#39;</span><span class="p">)</span>

    <span class="c1"># =================================================================</span>
    <span class="c1"># Parámetro: Radiación de onda larga entrante</span>
    <span class="c1"># =================================================================</span>

    <span class="c1"># ea: effective atmospheric emissivity (eq. 25)</span>
    <span class="n">atm_emissivity_ea</span> <span class="o">=</span> <span class="n">t_sw</span><span class="o">.</span><span class="n">expression</span><span class="p">(</span><span class="s1">&#39;0.85*(- log(t_sw))**0.09&#39;</span><span class="p">,</span>
                                        <span class="p">{</span><span class="s1">&#39;t_sw&#39;</span><span class="p">:</span> <span class="n">t_sw</span><span class="p">}</span>
                                        <span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s1">&#39;atm_emissivity_ea&#39;</span><span class="p">)</span>

    <span class="c1"># Finalmente: R_l_in (eq. 24)</span>
    <span class="n">R_l_in</span> <span class="o">=</span> <span class="n">atm_emissivity_ea</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="mf">5.67E-08</span><span class="p">)</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s1">&#39;R_l_in&#39;</span><span class="p">)</span>

    <span class="c1"># =================================================================</span>
    <span class="c1"># Parámetro: Radiación de onda larga saliente (eq.  16)</span>
    <span class="c1"># =================================================================</span>

    <span class="n">R_l_out</span> <span class="o">=</span> <span class="n">e_0</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="mf">5.67E-08</span><span class="p">)</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s1">&#39;R_l_out&#39;</span><span class="p">)</span>

    <span class="c1"># =================================================================</span>
    <span class="c1"># Parámetro: Albedo</span>
    <span class="c1"># =================================================================</span>

    <span class="c1"># Corrección atmosférica - Tasumi et al. (2007) (eqs. 10 - 14)</span>
    <span class="n">img_sr_tasumi</span> <span class="o">=</span> <span class="n">convert_TOA_to_SR</span><span class="p">(</span><span class="n">img_toa</span><span class="p">,</span> <span class="n">P_air</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">cos_theta_hor</span><span class="p">)</span>

    <span class="c1"># Albedo (eq. 15)</span>
    <span class="n">img_albedo</span> <span class="o">=</span> <span class="n">get_albedo</span><span class="p">(</span><span class="n">img_sr_tasumi</span><span class="p">,</span> <span class="n">albedo_method</span><span class="p">)</span>

    <span class="c1"># Radiación Neta (eq. 2)</span>
    <span class="n">Rn</span> <span class="o">=</span> <span class="n">img_albedo</span><span class="o">.</span><span class="n">expression</span><span class="p">(</span>
        <span class="s1">&#39;(1-albedo)*R_s_in + (R_l_in - R_l_out) - (1-e_0)*R_l_in&#39;</span><span class="p">,</span>
        <span class="p">{</span><span class="s1">&#39;albedo&#39;</span><span class="p">:</span><span class="n">img_albedo</span><span class="p">,</span>
         <span class="s1">&#39;R_s_in&#39;</span><span class="p">:</span><span class="n">R_s_in</span><span class="p">,</span>
         <span class="s1">&#39;R_l_in&#39;</span><span class="p">:</span><span class="n">R_l_in</span><span class="p">,</span>
         <span class="s1">&#39;R_l_out&#39;</span><span class="p">:</span><span class="n">R_l_out</span><span class="p">,</span>
         <span class="s1">&#39;e_0&#39;</span><span class="p">:</span><span class="n">e_0</span><span class="p">}</span>
         <span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s1">&#39;R_n&#39;</span><span class="p">)</span>

    <span class="n">img_Rn</span> <span class="o">=</span> <span class="n">Rn</span><span class="o">.</span><span class="n">addBands</span><span class="p">([</span><span class="n">R_s_in</span><span class="p">,</span> <span class="n">R_l_in</span><span class="p">,</span> <span class="n">R_l_out</span><span class="p">])</span>

    <span class="c1"># Juntar los parámetros obtenidos en una sola imagen</span>
    <span class="n">img_productos</span> <span class="o">=</span> <span class="n">ee</span><span class="o">.</span><span class="n">Image</span><span class="p">([</span>
        <span class="n">img_ndvi</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;NDVI&#39;</span><span class="p">),</span>
        <span class="n">img_savi</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;SAVI&#39;</span><span class="p">),</span>
        <span class="n">img_lai</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;LAI&#39;</span><span class="p">),</span>
        <span class="n">img_albedo</span><span class="p">,</span>
        <span class="n">ts</span><span class="p">,</span>
        <span class="n">ts_c</span><span class="p">,</span>
        <span class="n">t_sw</span><span class="p">,</span>
        <span class="n">e_0</span><span class="p">,</span>
        <span class="n">e_nb</span><span class="p">,</span>
        <span class="n">cos_theta_rel</span><span class="p">,</span>
        <span class="n">cos_theta_hor</span><span class="p">,</span>
        <span class="n">img_slopes</span><span class="p">,</span>
        <span class="n">dem</span>
        <span class="p">])</span>

    <span class="n">img_productos_dict</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;img_Rn&#39;</span><span class="p">:</span> <span class="n">img_Rn</span><span class="p">,</span>
        <span class="s1">&#39;img_SR&#39;</span><span class="p">:</span> <span class="n">img_sr_tasumi</span><span class="p">,</span>
        <span class="s1">&#39;img_toa&#39;</span><span class="p">:</span> <span class="n">img_toa</span><span class="p">,</span>
        <span class="s1">&#39;img_productos&#39;</span><span class="p">:</span> <span class="n">img_productos</span><span class="p">,</span>
        <span class="s1">&#39;d2&#39;</span><span class="p">:</span> <span class="n">d2</span><span class="p">,</span>
        <span class="s1">&#39;doy&#39;</span><span class="p">:</span> <span class="n">doy</span><span class="p">,</span>
        <span class="s1">&#39;fecha&#39;</span><span class="p">:</span> <span class="n">fecha</span>
    <span class="p">}</span>
        
    <span class="k">return</span> <span class="n">img_productos_dict</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="procesamiento">
<h2><span class="section-number">4.3. </span>Procesamiento<a class="headerlink" href="#procesamiento" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># =============================================================</span>
<span class="c1"># Parámetros de visualización de mapas con geemap</span>
<span class="c1"># =============================================================</span>

<span class="c1"># Diccionario de visualización de imágenes Landsat 8 y 9 TOA</span>
<span class="n">vis_rgb</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;min&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span> <span class="s1">&#39;max&#39;</span><span class="p">:</span> <span class="mf">0.3</span><span class="p">,</span> <span class="s1">&#39;bands&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;B4&#39;</span><span class="p">,</span> <span class="s1">&#39;B3&#39;</span><span class="p">,</span> <span class="s1">&#39;B2&#39;</span><span class="p">]}</span> 

<span class="c1"># Paletas de colores</span>
<span class="n">albedo_cmap</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;68181f&#39;</span><span class="p">,</span> <span class="s1">&#39;d6604d&#39;</span><span class="p">,</span> <span class="s1">&#39;f9dbc7&#39;</span><span class="p">,</span> <span class="s1">&#39;d1e5f0&#39;</span><span class="p">,</span> <span class="s1">&#39;2166ac&#39;</span><span class="p">,</span> <span class="s1">&#39;053061&#39;</span><span class="p">]</span> <span class="c1"># 0 - 0.5</span>
<span class="n">ndvi_cmap</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;ffffff&#39;</span><span class="p">,</span> <span class="s1">&#39;ce7e45&#39;</span><span class="p">,</span> <span class="s1">&#39;fad163&#39;</span><span class="p">,</span> <span class="s1">&#39;74a909&#39;</span><span class="p">,</span> <span class="s1">&#39;3a7405&#39;</span><span class="p">,</span> <span class="s1">&#39;1a3b03&#39;</span><span class="p">]</span> <span class="c1"># -0.2 - 1  &#39;0048fb&#39;,</span>
<span class="n">ts_cmap</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;fefccc&#39;</span><span class="p">,</span> <span class="s1">&#39;fbd976&#39;</span><span class="p">,</span> <span class="s1">&#39;f08c39&#39;</span><span class="p">,</span> <span class="s1">&#39;ea4a33&#39;</span><span class="p">,</span> <span class="s1">&#39;e43d32&#39;</span><span class="p">,</span> <span class="s1">&#39;812026&#39;</span><span class="p">]</span> <span class="c1"># 280 - 330 en K o 6.85 - 56.85 en °C</span>
<span class="n">rn_cmp</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;560e0d&#39;</span><span class="p">,</span> <span class="s1">&#39;fd5903&#39;</span><span class="p">,</span> <span class="s1">&#39;fbfe04&#39;</span><span class="p">,</span> <span class="s1">&#39;3aff01&#39;</span><span class="p">,</span> <span class="s1">&#39;01feef&#39;</span><span class="p">,</span> <span class="s1">&#39;0000fe&#39;</span><span class="p">,</span> <span class="s1">&#39;fd6dfd&#39;</span><span class="p">,</span> <span class="s1">&#39;ffffff&#39;</span><span class="p">]</span>
<span class="n">rn_cmp_r</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;ffffff&#39;</span><span class="p">,</span> <span class="s1">&#39;fd6dfd&#39;</span><span class="p">,</span> <span class="s1">&#39;0000fe&#39;</span><span class="p">,</span> <span class="s1">&#39;01feef&#39;</span><span class="p">,</span> <span class="s1">&#39;3aff01&#39;</span><span class="p">,</span> <span class="s1">&#39;fbfe04&#39;</span><span class="p">,</span> <span class="s1">&#39;fd5903&#39;</span><span class="p">,</span> <span class="s1">&#39;560e0d&#39;</span><span class="p">]</span>

<span class="c1"># =============================================================</span>
<span class="c1"># Inputs iniciales</span>
<span class="c1"># =============================================================</span>

<span class="c1"># Datos</span>
<span class="c1"># 2 de Diciembre 2021: Almácigo</span>
<span class="c1"># 4 de Enero 2022: Transplante</span>

<span class="c1"># 8 Imágenes Landsat seleccionadas</span>
<span class="n">lista_ids</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;LANDSAT/LC09/C02/T1/LC09_010065_20220113&#39;</span><span class="p">,</span>  <span class="c1"># 0 - 01/13 - l9 OJO: NDVI negativos -&gt; Posible riego 01 13</span>
    <span class="s1">&#39;LANDSAT/LC09/C02/T1/LC09_010065_20220129&#39;</span><span class="p">,</span>  <span class="c1"># 1 - 01/29 - l9 # Error con iteración</span>
    <span class="s1">&#39;LANDSAT/LC08/C02/T1/LC08_010065_20220310&#39;</span><span class="p">,</span>  <span class="c1"># 2 - 03/10 - l8</span>
    <span class="s1">&#39;LANDSAT/LC09/C02/T1/LC09_010065_20220403&#39;</span><span class="p">,</span>  <span class="c1"># 3 - 04/03 - l9 &lt;------</span>
    <span class="s1">&#39;LANDSAT/LC09/C02/T1/LC09_010065_20220505&#39;</span><span class="p">,</span>  <span class="c1"># 4 - 05/05 - l9 &lt;------</span>
    <span class="s1">&#39;LANDSAT/LC09/C02/T1/LC09_010065_20220521&#39;</span><span class="p">,</span>  <span class="c1"># 5 - 05/21 - l9 &lt;------</span>
    <span class="s1">&#39;LANDSAT/LC08/C02/T1/LC08_010065_20220614&#39;</span>   <span class="c1"># 6 - 06/14 - l8</span>
<span class="p">]</span>

<span class="c1"># DEM SRTM </span>
<span class="c1"># Ojo: El mapa Aspect no se puede obtener en los límites -&gt; usar áreas mayores al área de estudio</span>
<span class="n">dem</span> <span class="o">=</span> <span class="n">ee</span><span class="o">.</span><span class="n">Image</span><span class="p">(</span><span class="s2">&quot;USGS/SRTMGL1_003&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">roi</span><span class="p">)</span>

<span class="c1"># =============================================================</span>
<span class="c1"># Procesar las imagenes e incluirlos en una lista</span>
<span class="c1"># =============================================================</span>

<span class="c1"># Asignar método de estimación de LAI</span>
<span class="c1"># 0: Savi con l=0.1 </span>
<span class="c1"># 1: Savi con L=0.5 </span>
<span class="c1"># 2: Relación lineal NDVI - IAF: 2.1362*NDVI + 0.0869</span>
<span class="c1"># 3: Relación cuadrada NDVI - IAF : 2.3523*NDVI^2 - 1.9013*NDVI + 1.7714</span>
<span class="n">lai_method</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">albedo_method</span> <span class="o">=</span> <span class="s1">&#39;0.254*B2 + 0.149*B3 + 0.147*B4 + 0.311*B5 + 0.103*B6 + 0.036*B7&#39;</span>

<span class="n">HR</span> <span class="o">=</span> <span class="p">[</span>
    <span class="mi">82</span><span class="p">,</span> <span class="c1"># 0 &#39;2022-01-13&#39;</span>
    <span class="mi">81</span><span class="p">,</span> <span class="c1"># 1 &#39;2022-01-29&#39;</span>
    <span class="mi">83</span><span class="p">,</span> <span class="c1"># 2 &#39;2022-03-10&#39;</span>
    <span class="mi">72</span><span class="p">,</span> <span class="c1"># 3 &#39;2022-04-03&#39; # Sin dato</span>
    <span class="mi">70</span><span class="p">,</span> <span class="c1"># 4 &#39;2022-05-05&#39; # Sin dato </span>
    <span class="mi">68</span><span class="p">,</span> <span class="c1"># 5 &#39;2022-05-21&#39; # Sin dato</span>
    <span class="mi">65</span>  <span class="c1"># 6 &#39;2022-06-14&#39;</span>
<span class="p">]</span>

<span class="c1"># Lista en blanco que va a contener los resultados</span>
<span class="n">lista_imgprocesadas</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">img_id</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lista_ids</span><span class="p">):</span>

    <span class="c1"># Imagen Landsat mediante ID</span>
    <span class="n">img_ee</span> <span class="o">=</span> <span class="n">ee</span><span class="o">.</span><span class="n">Image</span><span class="p">(</span><span class="n">img_id</span><span class="p">)</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">roi</span><span class="p">)</span>

    <span class="c1"># Procesar Radiación Neta (produce un dict)</span>
    <span class="n">img_procesada_dict</span> <span class="o">=</span> <span class="n">getRadiacionNeta</span><span class="p">(</span><span class="n">img_ee</span><span class="p">,</span> <span class="n">predios_bound</span><span class="p">,</span> <span class="n">dem</span><span class="p">,</span>
                                          <span class="n">lai_method</span><span class="p">,</span> <span class="n">albedo_method</span><span class="p">,</span> <span class="n">HR</span><span class="p">[</span><span class="n">index</span><span class="p">])</span> <span class="c1"># roi: Ferreñafe</span>

    <span class="c1"># Recorte por regiones</span>
    <span class="n">img_procesada_dict</span><span class="p">[</span><span class="s1">&#39;img_productos&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">img_procesada_dict</span><span class="p">[</span><span class="s1">&#39;img_productos&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">predios_agricolas</span><span class="p">)</span> 
    <span class="n">img_procesada_dict</span><span class="p">[</span><span class="s1">&#39;img_toa&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">img_procesada_dict</span><span class="p">[</span><span class="s1">&#39;img_toa&#39;</span><span class="p">]</span>

    <span class="c1"># Agregar a lista en blanco</span>
    <span class="n">lista_imgprocesadas</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">img_procesada_dict</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Productos y Rn de imagen </span><span class="si">{</span><span class="n">img_procesada_dict</span><span class="p">[</span><span class="s1">&#39;fecha&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> procesada! lai_method = </span><span class="si">{</span><span class="n">lai_method</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">n_imgs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lista_imgprocesadas</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Productos y Rn de imagen 2022-01-13 procesada! lai_method = 1
Productos y Rn de imagen 2022-01-29 procesada! lai_method = 1
Productos y Rn de imagen 2022-03-10 procesada! lai_method = 1
Productos y Rn de imagen 2022-04-03 procesada! lai_method = 1
Productos y Rn de imagen 2022-05-05 procesada! lai_method = 1
Productos y Rn de imagen 2022-05-21 procesada! lai_method = 1
Productos y Rn de imagen 2022-06-14 procesada! lai_method = 1
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 0 - 01/13</span>
<span class="c1"># 1 - 01/29</span>
<span class="c1"># 2 - 03/10</span>
<span class="c1"># 3 - 04/03</span>
<span class="c1"># 4 - 05/05</span>
<span class="c1"># 5 - 05/21</span>
<span class="c1"># 6 - 06/14</span>

<span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>

<span class="n">img_productos</span> <span class="o">=</span> <span class="n">lista_imgprocesadas</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="s1">&#39;img_productos&#39;</span><span class="p">]</span>
<span class="n">img_rgb</span> <span class="o">=</span> <span class="n">lista_imgprocesadas</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="s1">&#39;img_toa&#39;</span><span class="p">]</span> 
<span class="n">img_sr</span> <span class="o">=</span> <span class="n">lista_imgprocesadas</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="s1">&#39;img_SR&#39;</span><span class="p">]</span> 

<span class="n">fecha</span> <span class="o">=</span> <span class="n">lista_imgprocesadas</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="s1">&#39;fecha&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">fecha</span><span class="p">)</span>

<span class="n">d2</span> <span class="o">=</span> <span class="n">lista_imgprocesadas</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="s1">&#39;d2&#39;</span><span class="p">]</span>
<span class="n">img_ndvi</span> <span class="o">=</span> <span class="n">img_productos</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;NDVI&#39;</span><span class="p">)</span>
<span class="n">img_savi</span> <span class="o">=</span> <span class="n">img_productos</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;SAVI&#39;</span><span class="p">)</span>
<span class="n">img_lai</span>  <span class="o">=</span> <span class="n">img_productos</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;LAI&#39;</span><span class="p">)</span>
<span class="n">img_albedo</span> <span class="o">=</span> <span class="n">img_productos</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;albedo&#39;</span><span class="p">)</span>
<span class="n">img_tempC</span> <span class="o">=</span> <span class="n">img_productos</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;Ts_c&#39;</span><span class="p">)</span>
<span class="n">img_tempK</span> <span class="o">=</span> <span class="n">img_productos</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;Ts_k&#39;</span><span class="p">)</span>
<span class="n">img_slope</span> <span class="o">=</span> <span class="n">img_productos</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;slope&#39;</span><span class="p">)</span>

<span class="n">cos_theta_rel</span> <span class="o">=</span> <span class="n">img_productos</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;cos_theta&#39;</span><span class="p">)</span>
<span class="n">t_sw</span> <span class="o">=</span> <span class="n">img_productos</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;t_sw&#39;</span><span class="p">)</span>
<span class="n">e_0</span>  <span class="o">=</span> <span class="n">img_productos</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;e_0&#39;</span><span class="p">)</span>

<span class="c1"># Estadísticas</span>
<span class="n">img_productos_dict</span> <span class="o">=</span> <span class="n">get_stats</span><span class="p">(</span><span class="n">img_productos</span><span class="p">,</span> <span class="n">predios_agricolas</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
<span class="n">img_productos_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">img_productos_dict</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">)</span> <span class="c1"># .round(3)</span>
<span class="n">display</span><span class="p">(</span><span class="n">img_productos_df</span><span class="p">[[</span><span class="s1">&#39;NDVI&#39;</span><span class="p">,</span>  <span class="s1">&#39;SAVI&#39;</span><span class="p">,</span> <span class="s1">&#39;LAI&#39;</span><span class="p">,</span> <span class="s1">&#39;albedo&#39;</span><span class="p">,</span> <span class="s1">&#39;Ts_k&#39;</span><span class="p">,</span> 
                          <span class="s1">&#39;Ts_c&#39;</span><span class="p">,</span> <span class="s1">&#39;t_sw&#39;</span><span class="p">,</span> <span class="s1">&#39;e_0&#39;</span><span class="p">,</span> <span class="s1">&#39;e_NB&#39;</span><span class="p">,</span> <span class="s1">&#39;cos_theta&#39;</span><span class="p">,</span> 
                          <span class="s1">&#39;cos_theta_1&#39;</span><span class="p">,</span> <span class="s1">&#39;slope&#39;</span><span class="p">,</span> <span class="s1">&#39;elevation&#39;</span><span class="p">]])</span>

<span class="n">vis_params_ndvi</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;min&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.2</span><span class="p">,</span> <span class="c1"># img_productos_dict[&#39;min&#39;][&#39;NDVI&#39;],</span>
    <span class="s1">&#39;max&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>    <span class="c1"># img_productos_dict[&#39;max&#39;][&#39;NDVI&#39;],</span>
    <span class="s1">&#39;palette&#39;</span><span class="p">:</span> <span class="n">ndvi_cmap</span> <span class="c1"># cmp.get_palette(&#39;RdYlGn&#39;)</span>
<span class="p">}</span>

<span class="n">vis_params_savi</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;min&#39;</span><span class="p">:</span> <span class="n">img_productos_dict</span><span class="p">[</span><span class="s1">&#39;min&#39;</span><span class="p">][</span><span class="s1">&#39;SAVI&#39;</span><span class="p">],</span>
    <span class="s1">&#39;max&#39;</span><span class="p">:</span> <span class="n">img_productos_dict</span><span class="p">[</span><span class="s1">&#39;max&#39;</span><span class="p">][</span><span class="s1">&#39;SAVI&#39;</span><span class="p">],</span>
    <span class="s1">&#39;palette&#39;</span><span class="p">:</span> <span class="n">ndvi_cmap</span> <span class="c1"># cmp.get_palette(&#39;RdYlGn&#39;)</span>
<span class="p">}</span>

<span class="n">vis_params_alb</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;min&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s1">&#39;max&#39;</span><span class="p">:</span> <span class="mf">0.25</span><span class="p">,</span>
    <span class="s1">&#39;palette&#39;</span><span class="p">:</span> <span class="n">ndvi_cmap</span><span class="c1">#cmp.get_palette(&#39;gray&#39;) </span>
<span class="p">}</span>

<span class="n">vis_params_ts</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;min&#39;</span><span class="p">:</span> <span class="n">img_productos_dict</span><span class="p">[</span><span class="s1">&#39;min&#39;</span><span class="p">][</span><span class="s1">&#39;Ts_c&#39;</span><span class="p">],</span>
    <span class="s1">&#39;max&#39;</span><span class="p">:</span> <span class="n">img_productos_dict</span><span class="p">[</span><span class="s1">&#39;max&#39;</span><span class="p">][</span><span class="s1">&#39;Ts_c&#39;</span><span class="p">],</span>
    <span class="s1">&#39;palette&#39;</span><span class="p">:</span><span class="n">cmp</span><span class="o">.</span><span class="n">get_palette</span><span class="p">(</span><span class="s1">&#39;RdYlBu_r&#39;</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">vis_params_lai</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;min&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>  
    <span class="s1">&#39;max&#39;</span><span class="p">:</span> <span class="n">img_productos_dict</span><span class="p">[</span><span class="s1">&#39;max&#39;</span><span class="p">][</span><span class="s1">&#39;LAI&#39;</span><span class="p">],</span> 
    <span class="s1">&#39;palette&#39;</span><span class="p">:</span> <span class="n">cmp</span><span class="o">.</span><span class="n">get_palette</span><span class="p">(</span><span class="s1">&#39;cubehelix_r&#39;</span><span class="p">)</span> <span class="c1"># RdYlGn_r, afmhot, turbo_r</span>
<span class="p">}</span>

<span class="c1"># Después del filtrado de valores negativos de LAI</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-01-13
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>NDVI</th>
      <th>SAVI</th>
      <th>LAI</th>
      <th>albedo</th>
      <th>Ts_k</th>
      <th>Ts_c</th>
      <th>t_sw</th>
      <th>e_0</th>
      <th>e_NB</th>
      <th>cos_theta</th>
      <th>cos_theta_1</th>
      <th>slope</th>
      <th>elevation</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>max</th>
      <td>0.638488</td>
      <td>0.435078</td>
      <td>0.922158</td>
      <td>0.185254</td>
      <td>299.216006</td>
      <td>26.066006</td>
      <td>0.742318</td>
      <td>0.985000</td>
      <td>0.985000</td>
      <td>0.896870</td>
      <td>0.843824</td>
      <td>6.230337</td>
      <td>54.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>0.173787</td>
      <td>0.091732</td>
      <td>0.045677</td>
      <td>0.108548</td>
      <td>293.576264</td>
      <td>20.426264</td>
      <td>0.735345</td>
      <td>0.952486</td>
      <td>0.971020</td>
      <td>0.843778</td>
      <td>0.843770</td>
      <td>1.692440</td>
      <td>46.121525</td>
    </tr>
    <tr>
      <th>median</th>
      <td>0.154227</td>
      <td>0.079912</td>
      <td>0.000028</td>
      <td>0.105683</td>
      <td>293.096246</td>
      <td>19.968177</td>
      <td>0.736632</td>
      <td>0.950009</td>
      <td>0.970001</td>
      <td>0.843791</td>
      <td>0.843771</td>
      <td>1.860307</td>
      <td>46.000000</td>
    </tr>
    <tr>
      <th>min</th>
      <td>-0.147715</td>
      <td>-0.069146</td>
      <td>0.000000</td>
      <td>0.060872</td>
      <td>291.016862</td>
      <td>17.866862</td>
      <td>0.719278</td>
      <td>0.950000</td>
      <td>0.970000</td>
      <td>0.802741</td>
      <td>0.843710</td>
      <td>0.000000</td>
      <td>40.000000</td>
    </tr>
    <tr>
      <th>mode</th>
      <td>0.126766</td>
      <td>0.072537</td>
      <td>0.000028</td>
      <td>0.084238</td>
      <td>292.661617</td>
      <td>19.529479</td>
      <td>0.737858</td>
      <td>0.950009</td>
      <td>0.970001</td>
      <td>0.839194</td>
      <td>0.843756</td>
      <td>0.930368</td>
      <td>45.000000</td>
    </tr>
    <tr>
      <th>stdDev</th>
      <td>0.121992</td>
      <td>0.069060</td>
      <td>0.104066</td>
      <td>0.026230</td>
      <td>1.565740</td>
      <td>1.565740</td>
      <td>0.004381</td>
      <td>0.008133</td>
      <td>0.003485</td>
      <td>0.013254</td>
      <td>0.000030</td>
      <td>0.961340</td>
      <td>2.046017</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<section id="revisando-datos">
<h3><span class="section-number">4.3.1. </span>Revisando datos<a class="headerlink" href="#revisando-datos" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Antes del filtrado de valores negativos de LAI</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-01-13
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>NDVI</th>
      <th>SAVI</th>
      <th>LAI</th>
      <th>albedo</th>
      <th>Ts_k</th>
      <th>Ts_c</th>
      <th>t_sw</th>
      <th>e_0</th>
      <th>e_NB</th>
      <th>cos_theta</th>
      <th>cos_theta_1</th>
      <th>slope</th>
      <th>elevation</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>max</th>
      <td>0.638488</td>
      <td>0.435078</td>
      <td>0.922158</td>
      <td>0.185254</td>
      <td>299.222790</td>
      <td>26.072790</td>
      <td>0.742318</td>
      <td>0.985000</td>
      <td>0.985000</td>
      <td>0.896870</td>
      <td>0.843824</td>
      <td>6.230337</td>
      <td>54.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>0.173787</td>
      <td>0.091732</td>
      <td>-0.007041</td>
      <td>0.108548</td>
      <td>293.583745</td>
      <td>20.433745</td>
      <td>0.735324</td>
      <td>0.952084</td>
      <td>0.970888</td>
      <td>0.843778</td>
      <td>0.843770</td>
      <td>1.692440</td>
      <td>46.121525</td>
    </tr>
    <tr>
      <th>median</th>
      <td>0.154227</td>
      <td>0.079912</td>
      <td>-0.035152</td>
      <td>0.105683</td>
      <td>293.152533</td>
      <td>19.968835</td>
      <td>0.736626</td>
      <td>0.949824</td>
      <td>0.969940</td>
      <td>0.843791</td>
      <td>0.843771</td>
      <td>1.860307</td>
      <td>46.000000</td>
    </tr>
    <tr>
      <th>min</th>
      <td>-0.147715</td>
      <td>-0.069146</td>
      <td>-0.277002</td>
      <td>0.060869</td>
      <td>291.016862</td>
      <td>17.866862</td>
      <td>0.719258</td>
      <td>0.948291</td>
      <td>0.969436</td>
      <td>0.802741</td>
      <td>0.843710</td>
      <td>0.000000</td>
      <td>40.000000</td>
    </tr>
    <tr>
      <th>mode</th>
      <td>0.126766</td>
      <td>0.072537</td>
      <td>-0.050153</td>
      <td>0.084238</td>
      <td>292.661384</td>
      <td>19.531620</td>
      <td>0.737855</td>
      <td>0.949579</td>
      <td>0.969877</td>
      <td>0.839194</td>
      <td>0.843756</td>
      <td>0.930368</td>
      <td>45.000000</td>
    </tr>
    <tr>
      <th>stdDev</th>
      <td>0.121992</td>
      <td>0.069060</td>
      <td>0.139392</td>
      <td>0.026231</td>
      <td>1.565671</td>
      <td>1.565671</td>
      <td>0.004381</td>
      <td>0.008268</td>
      <td>0.003527</td>
      <td>0.013254</td>
      <td>0.000030</td>
      <td>0.961340</td>
      <td>2.046017</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Generar gráficas de variables determinadas</span>
<span class="c1"># [&#39;NDVI&#39;,  &#39;SAVI&#39;, &#39;LAI&#39;, &#39;albedo&#39;, &#39;Ts_k&#39;, &#39;Ts_c&#39;, &#39;t_sw&#39;, &#39;e_0&#39;, &#39;e_NB&#39;, &#39;cos_theta&#39;, &#39;cos_theta_1&#39;, &#39;slope&#39;, &#39;elevation&#39;]</span>
<span class="k">for</span> <span class="n">n_img</span><span class="p">,</span> <span class="n">img</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lista_imgprocesadas</span><span class="p">):</span>

    <span class="c1"># img_rgb_sr = img[&#39;img_SR&#39;]</span>
    <span class="n">img_</span> <span class="o">=</span> <span class="n">img</span><span class="p">[</span><span class="s1">&#39;img_productos&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;LAI&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">predios_agricolas</span><span class="p">)</span>
    <span class="n">fecha</span> <span class="o">=</span> <span class="n">img</span><span class="p">[</span><span class="s1">&#39;fecha&#39;</span><span class="p">]</span>

    <span class="n">img_productos_dict</span> <span class="o">=</span> <span class="n">get_stats</span><span class="p">(</span><span class="n">img_</span><span class="p">,</span> <span class="n">predios_agricolas</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
    <span class="n">img_productos_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">img_productos_dict</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">)</span> <span class="c1"># .round(3)</span>

    <span class="n">vis_params_lai</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;min&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>  
        <span class="s1">&#39;max&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> 
        <span class="s1">&#39;palette&#39;</span><span class="p">:</span> <span class="n">ndvi_cmap</span><span class="c1"># cmp.get_palette(&#39;cubehelix_r&#39;) # RdYlGn_r, afmhot, turbo_r</span>
    <span class="p">}</span>
    
    <span class="c1"># vis_params_ndvi = {&#39;min&#39;: 0,</span>
    <span class="c1">#                    &#39;max&#39;: 1,</span>
    <span class="c1">#                    &#39;palette&#39;: ndvi_cmap}</span>
    
    <span class="c1"># vis_params_sr = {&#39;bands&#39;: [&#39;SR_B4&#39;, &#39;SR_B3&#39;, &#39;SR_B2&#39;], &#39;min&#39;: 0.0, &#39;max&#39;: 0.3, &#39;gamma&#39;:1.3}</span>
    <span class="c1"># vis_params_alb = {</span>
    <span class="c1">#     &#39;min&#39;: 0,</span>
    <span class="c1">#     &#39;max&#39;: 0.25,</span>
    <span class="c1">#     &#39;palette&#39;: ndvi_cmap#cmp.get_palette(&#39;gray&#39;) </span>
    <span class="c1"># }</span>
    
    <span class="n">title_map</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">fecha</span><span class="si">}</span><span class="s1"> - LAI_min0&#39;</span>
    
    <span class="n">get_grafica_cartoee_color</span><span class="p">(</span><span class="n">img_</span><span class="o">.</span><span class="n">blend</span><span class="p">(</span><span class="n">predios_vis</span><span class="p">),</span> 
                                  <span class="n">vis_params_lai</span><span class="p">,</span>                              
                                  <span class="n">text</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                                  <span class="n">title_map</span><span class="o">=</span><span class="n">title_map</span><span class="p">,</span>
                                  <span class="n">label</span><span class="o">=</span><span class="s1">&#39;LAI&#39;</span><span class="p">,</span> 
                                  <span class="n">save_fig</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">fecha</span><span class="si">}</span><span class="s1">_LAI1_min0&#39;</span><span class="p">,</span>
                                  <span class="n">nogrid</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/a7753dc459d2050fb50c4212062f6084445e661e2413908ba01b66453da93cbb.png" src="_images/a7753dc459d2050fb50c4212062f6084445e661e2413908ba01b66453da93cbb.png" />
<img alt="_images/93c4d056acc5bcc4ba66ab950774927544f50e1fdb62f62c9f865ff72e22d485.png" src="_images/93c4d056acc5bcc4ba66ab950774927544f50e1fdb62f62c9f865ff72e22d485.png" />
<img alt="_images/cf976dd44ee75a1a0d3f1e3ad2159738d9aea6b4a2ed48fb44440d5b4c9da4fc.png" src="_images/cf976dd44ee75a1a0d3f1e3ad2159738d9aea6b4a2ed48fb44440d5b4c9da4fc.png" />
<img alt="_images/01264a96355a419dae638866422a5c073b28fc8823c3fe07f50313f5cdc5758b.png" src="_images/01264a96355a419dae638866422a5c073b28fc8823c3fe07f50313f5cdc5758b.png" />
<img alt="_images/6398d655a2d75a5f395a7dc2a02588d34bccb8616137e5e697eef4da075764b5.png" src="_images/6398d655a2d75a5f395a7dc2a02588d34bccb8616137e5e697eef4da075764b5.png" />
<img alt="_images/fcce59b966f279b0525a911ba1a581501e568295cbb513d56aba51b13a434d4b.png" src="_images/fcce59b966f279b0525a911ba1a581501e568295cbb513d56aba51b13a434d4b.png" />
<img alt="_images/75c744b5b34bd0ec9f8120ee1ce7c7e55c19e7b0f1b9776954e54a198fe66c28.png" src="_images/75c744b5b34bd0ec9f8120ee1ce7c7e55c19e7b0f1b9776954e54a198fe66c28.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">vis_params_ndvi</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;min&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.2</span><span class="p">,</span> <span class="c1"># img_productos_dict[&#39;min&#39;][&#39;NDVI&#39;],</span>
    <span class="s1">&#39;max&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>    <span class="c1"># img_productos_dict[&#39;max&#39;][&#39;NDVI&#39;],</span>
    <span class="s1">&#39;palette&#39;</span><span class="p">:</span> <span class="n">ndvi_cmap</span> <span class="c1"># cmp.get_palette(&#39;RdYlGn&#39;)</span>
<span class="p">}</span>

<span class="n">vis_params_lai</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;min&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>  
    <span class="s1">&#39;max&#39;</span><span class="p">:</span> <span class="n">img_productos_dict</span><span class="p">[</span><span class="s1">&#39;max&#39;</span><span class="p">][</span><span class="s1">&#39;LAI&#39;</span><span class="p">],</span> 
    <span class="s1">&#39;palette&#39;</span><span class="p">:</span> <span class="n">ndvi_cmap</span> <span class="c1"># RdYlGn_r, afmhot, turbo_r</span>
<span class="p">}</span>

<span class="n">img_lai</span>  <span class="o">=</span> <span class="n">img_productos</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;LAI&#39;</span><span class="p">)</span>
<span class="n">img_lai_n</span> <span class="o">=</span> <span class="n">img_lai</span><span class="o">.</span><span class="n">updateMask</span><span class="p">(</span><span class="n">img_lai</span><span class="o">.</span><span class="n">lte</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>

<span class="c1"># Mapas</span>
<span class="n">Map</span> <span class="o">=</span> <span class="n">geemap</span><span class="o">.</span><span class="n">Map</span><span class="p">()</span>
<span class="n">Map</span><span class="o">.</span><span class="n">centerObject</span><span class="p">(</span><span class="n">predios_agricolas</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">Map</span><span class="o">.</span><span class="n">addLayer</span><span class="p">(</span><span class="n">img_rgb</span><span class="p">,</span> <span class="n">vis_rgb</span><span class="p">,</span> <span class="s1">&#39;img_rgb&#39;</span><span class="p">)</span>
<span class="n">Map</span><span class="o">.</span><span class="n">addLayer</span><span class="p">(</span><span class="n">img_ndvi</span><span class="p">,</span> <span class="n">vis_params_ndvi</span><span class="p">,</span> <span class="s1">&#39;img_ndvi&#39;</span><span class="p">)</span>
<span class="n">Map</span><span class="o">.</span><span class="n">addLayer</span><span class="p">(</span><span class="n">img_lai</span><span class="p">,</span>  <span class="n">vis_params_lai</span><span class="p">,</span> <span class="s1">&#39;img_lai&#39;</span><span class="p">)</span>
<span class="n">Map</span><span class="o">.</span><span class="n">addLayer</span><span class="p">(</span><span class="n">img_lai_n</span><span class="p">,</span> <span class="p">{},</span> <span class="s1">&#39;img_lai_n&#39;</span><span class="p">)</span>
<span class="n">Map</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "26958a8dd6bc45a5aad34d79834836ac", "version_major": 2, "version_minor": 0}</script></div>
</div>
</section>
<section id="funcion-recorte-por-percentiles">
<h3><span class="section-number">4.3.2. </span>Función <code class="docutils literal notranslate"><span class="pre">recorte_por_percentiles</span></code><a class="headerlink" href="#funcion-recorte-por-percentiles" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">recorte_por_percentiles_alb</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">img_ndvi</span><span class="p">,</span> <span class="n">img_albedo</span><span class="p">,</span> <span class="n">geometry</span><span class="p">,</span> <span class="n">filtrado</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Recortar mapas de temperatura en función de mapa NDVI para obtener pixeles candidatos.</span>

<span class="sd">    Parametros</span>
<span class="sd">    ----------</span>
<span class="sd">    n1, n2 : int</span>
<span class="sd">    img_ndvi : ee.Image</span>
<span class="sd">    img_ts : ee.Image</span>
<span class="sd">    geometry : ee.Geometry</span>
<span class="sd">    filtrado : str</span>

<span class="sd">    Retorna</span>
<span class="sd">    -------</span>
<span class="sd">    pixeles : ee.Image</span>
<span class="sd">        Mapa recortado (por updateMask) de pixeles candidatos.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># 1. Procesar n1</span>
    <span class="c1"># Para NDVI &gt; 0, retorna el percentil n1</span>
    <span class="n">perc_n1</span> <span class="o">=</span> <span class="n">ee</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">img_ndvi</span>
                        <span class="o">.</span><span class="n">updateMask</span><span class="p">(</span><span class="n">img_ndvi</span><span class="o">.</span><span class="n">gte</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
                        <span class="o">.</span><span class="n">reduceRegion</span><span class="p">(</span><span class="n">ee</span><span class="o">.</span><span class="n">Reducer</span><span class="o">.</span><span class="n">percentile</span><span class="p">([</span><span class="n">n1</span><span class="p">]),</span> <span class="n">geometry</span><span class="o">=</span><span class="n">geometry</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
                        <span class="o">.</span><span class="n">values</span><span class="p">()</span>
        <span class="p">)</span>
    
    <span class="k">if</span> <span class="n">filtrado</span> <span class="o">==</span> <span class="s1">&#39;cold&#39;</span><span class="p">:</span>
        <span class="c1"># Pixel frío</span>
        <span class="c1"># Para los valores de ndvi mayores al percentil perc_n1, retornar sus temperaturas</span>
        <span class="n">alb_recortado_p_n1</span> <span class="o">=</span> <span class="n">img_albedo</span><span class="o">.</span><span class="n">updateMask</span><span class="p">(</span><span class="n">img_ndvi</span><span class="o">.</span><span class="n">gte</span><span class="p">(</span><span class="n">perc_n1</span><span class="p">))</span> <span class="c1"># Albedo</span>
    <span class="k">else</span><span class="p">:</span> 
        <span class="c1"># Pixel caliente</span>
        <span class="n">img_ndvi</span> <span class="o">=</span> <span class="n">img_ndvi</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">geometry</span><span class="p">)</span>
        <span class="n">img_albedo</span> <span class="o">=</span> <span class="n">img_albedo</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">geometry</span><span class="p">)</span>
        <span class="c1"># Para los valores de ndvi menores al percentil perc_n1, retornar sus temperaturas</span>
        <span class="n">alb_recortado_p_n1</span> <span class="o">=</span> <span class="n">img_albedo</span><span class="o">.</span><span class="n">updateMask</span><span class="p">(</span><span class="n">img_ndvi</span><span class="o">.</span><span class="n">lte</span><span class="p">(</span><span class="n">perc_n1</span><span class="p">))</span>
        
    <span class="c1"># 2. Procesar n2</span>
    <span class="n">perc_n2</span> <span class="o">=</span> <span class="n">ee</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">alb_recortado_p_n1</span>
                        <span class="o">.</span><span class="n">reduceRegion</span><span class="p">(</span><span class="n">ee</span><span class="o">.</span><span class="n">Reducer</span><span class="o">.</span><span class="n">percentile</span><span class="p">([</span><span class="n">n2</span><span class="p">]),</span> <span class="n">geometry</span><span class="o">=</span><span class="n">geometry</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
                        <span class="o">.</span><span class="n">values</span><span class="p">()</span>
        <span class="p">)</span>
    
    <span class="k">if</span> <span class="n">filtrado</span> <span class="o">==</span> <span class="s1">&#39;cold&#39;</span><span class="p">:</span>
        <span class="c1"># Los valores más bajos de temperatura</span>
        <span class="c1"># Los valores más altos de albedo</span>
        <span class="n">pixeles</span> <span class="o">=</span> <span class="n">alb_recortado_p_n1</span><span class="o">.</span><span class="n">updateMask</span><span class="p">(</span><span class="n">alb_recortado_p_n1</span><span class="o">.</span><span class="n">gte</span><span class="p">(</span><span class="n">perc_n2</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Los valores más altos de temperatura</span>
        <span class="c1"># Los valores más bajos de albedo</span>
        <span class="n">pixeles</span> <span class="o">=</span> <span class="n">alb_recortado_p_n1</span><span class="o">.</span><span class="n">updateMask</span><span class="p">(</span><span class="n">alb_recortado_p_n1</span><span class="o">.</span><span class="n">lte</span><span class="p">(</span><span class="n">perc_n2</span><span class="p">))</span>
            
    <span class="k">return</span> <span class="n">pixeles</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="pixeles-frios">
<h3><span class="section-number">4.3.3. </span>Pixeles Fríos<a class="headerlink" href="#pixeles-frios" title="Link to this heading">#</a></h3>
<p>Pixeles Fríos:
Encontrar el grupo de pixeles con</p>
<ul class="simple">
<li><p>NDVI alto</p></li>
<li><p>Temperatura superficial baja</p></li>
</ul>
<p>Procedimiento:</p>
<ul class="simple">
<li><p>Obtener percentil n1 para imagen NDVI con valores positivos <a class="reference external" href="https://developers.google.com/earth-engine/apidocs/ee-reducer-percentile">(ee.Reducer.percentile)</a></p></li>
<li><p>Obtener valores de NDVI &gt; n1</p></li>
<li><p>Recortar mapa de temperatura para valores Ts &lt; $n_2$ en función de valores de NDVI &gt; $n_1$</p></li>
<li><p>Seleccionar un pixel y anotar coordenadas</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Selección de Pixel Frío - Recorte de mapas</span>

<span class="c1"># 0 &#39;2022-01-13&#39; n1: 50 n2: 10</span>
<span class="c1"># 1 &#39;2022-01-29&#39; n1: 50 n2: 10</span>
<span class="c1"># 2 &#39;2022-03-10&#39; n1: 50 n2: 5</span>
<span class="c1"># 3 &#39;2022-04-03&#39; n1: 80 n2: 10</span>
<span class="c1"># 4 &#39;2022-05-05&#39; n1: 40 n2: 10</span>
<span class="c1"># 5 &#39;2022-05-21&#39; n1: 50 n2: 10</span>
<span class="c1"># 6 &#39;2022-06-14&#39; n1: 50 n2: 5</span>

<span class="n">perc_ndvi</span> <span class="o">=</span>  <span class="mi">80</span>  <span class="c1"># n1: Percentil para NDVI</span>
<span class="n">perc_temp</span> <span class="o">=</span>  <span class="mi">80</span>  <span class="c1"># n2: Percentil para albedo</span>

<span class="c1"># Procesado de imagen</span>
<span class="n">pixeles_frios</span> <span class="o">=</span> <span class="n">recorte_por_percentiles_alb</span><span class="p">(</span><span class="n">perc_ndvi</span><span class="p">,</span> <span class="n">perc_temp</span><span class="p">,</span> 
                                            <span class="n">img_ndvi</span><span class="p">,</span> <span class="n">img_albedo</span><span class="p">,</span> <span class="n">geometry</span><span class="o">=</span><span class="n">predios_agricolas</span><span class="p">,</span> 
                                            <span class="n">filtrado</span><span class="o">=</span><span class="s1">&#39;cold&#39;</span><span class="p">)</span>

<span class="c1"># Estadisticas</span>
<span class="n">pixeles_frios_stats</span> <span class="o">=</span> <span class="n">get_stats</span><span class="p">(</span><span class="n">pixeles_frios</span><span class="p">,</span> <span class="n">predios_agricolas</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>

<span class="c1"># =============================================================</span>
<span class="c1"># Visualizar</span>
<span class="c1"># ============================================================= </span>

<span class="c1"># 1. Inputs para gráfico con geemap</span>
<span class="n">paleta</span> <span class="o">=</span> <span class="s1">&#39;YlGn&#39;</span><span class="c1">#&#39;RdYlBu&#39;  # Rampa de color azul y rojo</span>
<span class="c1"># paleta = &#39;binary_r&#39;  # Color negro indica el pixel más frío</span>

<span class="n">vis_params_pix</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;min&#39;</span><span class="p">:</span> <span class="n">pixeles_frios_stats</span><span class="p">[</span><span class="s1">&#39;min&#39;</span><span class="p">][</span><span class="s1">&#39;albedo&#39;</span><span class="p">],</span>
    <span class="s1">&#39;max&#39;</span><span class="p">:</span> <span class="n">pixeles_frios_stats</span><span class="p">[</span><span class="s1">&#39;max&#39;</span><span class="p">][</span><span class="s1">&#39;albedo&#39;</span><span class="p">],</span>
    <span class="s1">&#39;palette&#39;</span><span class="p">:</span> <span class="n">cmp</span><span class="o">.</span><span class="n">get_palette</span><span class="p">(</span><span class="n">paleta</span><span class="p">)</span> <span class="c1">#ndvi_cmap </span>
<span class="p">}</span>

<span class="n">image</span> <span class="o">=</span> <span class="n">pixeles_frios</span><span class="o">.</span><span class="n">blend</span><span class="p">(</span><span class="n">predios_vis</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">lista_imgprocesadas</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="s1">&#39;fecha&#39;</span><span class="p">])</span>

<span class="c1"># 2. Visualización con geemap</span>
<span class="n">Map</span> <span class="o">=</span> <span class="n">geemap</span><span class="o">.</span><span class="n">Map</span><span class="p">()</span>
<span class="n">Map</span><span class="o">.</span><span class="n">centerObject</span><span class="p">(</span><span class="n">predios_agricolas</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>

<span class="n">Map</span><span class="o">.</span><span class="n">addLayer</span><span class="p">(</span><span class="n">img_rgb</span><span class="p">,</span> <span class="n">vis_rgb</span><span class="p">,</span> <span class="s1">&#39;RGB TOA&#39;</span><span class="p">)</span>
<span class="n">Map</span><span class="o">.</span><span class="n">addLayer</span><span class="p">(</span><span class="n">img_tempC</span><span class="p">,</span> <span class="n">vis_params_ts</span><span class="p">,</span> <span class="s1">&#39;img_ts&#39;</span><span class="p">)</span>
<span class="n">Map</span><span class="o">.</span><span class="n">addLayer</span><span class="p">(</span><span class="n">img_albedo</span><span class="p">,</span> <span class="n">vis_params_alb</span><span class="p">,</span> <span class="s1">&#39;img albedo&#39;</span><span class="p">)</span>
<span class="n">Map</span><span class="o">.</span><span class="n">addLayer</span><span class="p">(</span><span class="n">img_ndvi</span><span class="p">,</span> <span class="n">vis_params_ndvi</span><span class="p">,</span> <span class="s1">&#39;img_ndvi&#39;</span><span class="p">)</span>
<span class="n">Map</span><span class="o">.</span><span class="n">addLayer</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">vis_params_pix</span><span class="p">,</span> <span class="s1">&#39;Pixeles&#39;</span><span class="p">)</span>

<span class="c1"># Coordenadas previamente seleccionados (Pixel Frio)</span>
<span class="n">list_coords_pixf</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">[</span><span class="o">-</span><span class="mf">79.775487</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.601604</span><span class="p">],</span>  <span class="c1"># 0 &#39;2022-01-13&#39; n1: 50 n2: 10</span>
    <span class="p">[</span><span class="o">-</span><span class="mf">79.785809</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.598078</span><span class="p">],</span>  <span class="c1"># 1 &#39;2022-01-29&#39; n1: 50 n2: 10</span>
    <span class="p">[</span><span class="o">-</span><span class="mf">79.782536</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.601574</span><span class="p">],</span>  <span class="c1"># 2 &#39;2022-03-10&#39; n1: 50 n2: 5</span>
    <span class="p">[</span><span class="o">-</span><span class="mf">79.782545</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.601342</span><span class="p">],</span> <span class="c1"># 3 &#39;2022-04-03&#39; n1: 80 n2: 10 </span>
    <span class="p">[</span><span class="o">-</span><span class="mf">79.778744</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.604585</span><span class="p">],</span> <span class="c1"># 4 &#39;2022-05-05&#39; n1: 40 n2: 10</span>
    <span class="p">[</span><span class="o">-</span><span class="mf">79.778718</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.604593</span><span class="p">],</span> <span class="c1"># 5 &#39;2022-05-21&#39; n1: 50 n2: 10</span>
    <span class="p">[</span><span class="o">-</span><span class="mf">79.778739</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.604574</span><span class="p">],</span> <span class="c1"># 6 &#39;2022-06-14&#39; n1: 50 n2: 5</span>
<span class="p">]</span>

<span class="c1"># Coordenadas previamente seleccionados (Pixel Caliente)</span>
<span class="n">list_coords_pixc</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">[</span><span class="o">-</span><span class="mf">79.778176</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.605123</span><span class="p">],</span>  <span class="c1"># 0 &#39;2022-01-13&#39; n1: 50 n2: 10</span>
    <span class="p">[</span><span class="o">-</span><span class="mf">79.778717</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.604576</span><span class="p">],</span>  <span class="c1"># 1 &#39;2022-01-29&#39; n1: 50 n2: 10</span>
    <span class="p">[</span><span class="o">-</span><span class="mf">79.778736</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.604317</span><span class="p">],</span>  <span class="c1"># 2 &#39;2022-03-10&#39; n1: 50 n2: 5</span>
    <span class="p">[</span><span class="o">-</span><span class="mf">79.778468</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.603759</span><span class="p">],</span>  <span class="c1"># 3 &#39;2022-04-03&#39; n1: 80 n2: 10</span>
    <span class="p">[</span><span class="o">-</span><span class="mf">79.782006</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.598379</span><span class="p">],</span> <span class="c1"># 4 &#39;2022-05-05&#39; n1: 40 n2: 10 </span>
    <span class="p">[</span><span class="o">-</span><span class="mf">79.78228</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.596453</span><span class="p">],</span> <span class="c1"># 5 &#39;2022-05-21&#39; n1: 50 n2: 10</span>
    <span class="p">[</span><span class="o">-</span><span class="mf">79.784462</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.59621</span><span class="p">],</span> <span class="c1"># 6 &#39;2022-06-14&#39; n1: 50 n2: 5</span>
<span class="p">]</span>

<span class="n">Map</span><span class="o">.</span><span class="n">addLayer</span><span class="p">(</span><span class="n">ee</span><span class="o">.</span><span class="n">Geometry</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span><span class="n">list_coords_pixf</span><span class="p">[</span><span class="n">index</span><span class="p">]),</span> <span class="p">{},</span> <span class="s1">&#39;Pixel F&#39;</span><span class="p">)</span>
<span class="n">Map</span><span class="o">.</span><span class="n">addLayer</span><span class="p">(</span><span class="n">ee</span><span class="o">.</span><span class="n">Geometry</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span><span class="n">list_coords_pixc</span><span class="p">[</span><span class="n">index</span><span class="p">]),</span> <span class="p">{},</span> <span class="s1">&#39;Pixel C&#39;</span><span class="p">)</span>

<span class="c1"># Map.add_colorbar(vis_params_pix, orientation=&#39;vertical&#39;, label=&#39;Pixeles [°C]&#39;)</span>
<span class="n">Map</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-01-13
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "1315d2836abc47489761581987bc443c", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ===================================================================================================</span>
<span class="c1"># Selección de pixel frío</span>
<span class="c1"># 1. Ubica el pixel frío en el mapa y coloca un marker con la opción &quot;draw a marker&quot;</span>
<span class="c1"># 2. Una vez ubicado, correr la línea de abajo para obtener sus coordenadas [longitud, latitud]</span>
<span class="c1"># ===================================================================================================</span>

<span class="n">Map</span><span class="o">.</span><span class="n">user_rois</span><span class="o">.</span><span class="n">geometry</span><span class="p">()</span><span class="o">.</span><span class="n">coordinates</span><span class="p">()</span><span class="o">.</span><span class="n">getInfo</span><span class="p">()</span> 
<span class="c1"># PixC [-79.784183, -6.596201]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[[-79.784462, -6.59621], [-79.778739, -6.604574]]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lista_pixeles</span> <span class="o">=</span> <span class="p">[[</span><span class="o">-</span><span class="mf">79.781188</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.597254</span><span class="p">],</span>
 <span class="p">[</span><span class="o">-</span><span class="mf">79.781464</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.596444</span><span class="p">],</span>
 <span class="p">[</span><span class="o">-</span><span class="mf">79.782545</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.60132</span><span class="p">],</span>
 <span class="p">[</span><span class="o">-</span><span class="mf">79.77794</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.596974</span><span class="p">],</span>
 <span class="p">[</span><span class="o">-</span><span class="mf">79.775491</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.599975</span><span class="p">]]</span>

<span class="k">for</span> <span class="n">pixel</span> <span class="ow">in</span> <span class="n">lista_pixeles</span><span class="p">:</span>
    <span class="n">pixf_ee_coord</span> <span class="o">=</span> <span class="n">ee</span><span class="o">.</span><span class="n">Geometry</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span><span class="n">pixel</span><span class="p">)</span>
    <span class="n">pprint</span><span class="p">(</span><span class="n">get_pixel_values</span><span class="p">(</span><span class="n">pixf_ee_coord</span><span class="p">,</span> <span class="n">d2</span><span class="p">,</span> <span class="n">img_productos</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;Albedo&#39;: 0.18919493391900044,
 &#39;Elev_m&#39;: 46,
 &#39;G&#39;: 86.35100346713324,
 &#39;LAI&#39;: 1.3702012616807735,
 &#39;NDVI&#39;: 0.7111931119311191,
 &#39;R_n&#39;: 625.0357197343591,
 &#39;SAVI&#39;: 0.5204344820402325,
 &#39;Slope_d&#39;: 0.9335907697677612,
 &#39;T_sw&#39;: 0.7583149110836516,
 &#39;Ts_c&#39;: 14.479494257364593,
 &#39;Ts_k&#39;: 287.62949425736457,
 &#39;cos_theta&#39;: 0.8520663683717258,
 &#39;e_0&#39;: 0.9637020126168077}
{&#39;Albedo&#39;: 0.19020936565147673,
 &#39;Elev_m&#39;: 46,
 &#39;G&#39;: 89.20651539724177,
 &#39;LAI&#39;: 1.3839181538299294,
 &#39;NDVI&#39;: 0.7121879588839941,
 &#39;R_n&#39;: 648.6521680933619,
 &#39;SAVI&#39;: 0.5225379067137665,
 &#39;Slope_d&#39;: 2.7987873554229736,
 &#39;T_sw&#39;: 0.7576606473438545,
 &#39;Ts_c&#39;: 14.749357857032521,
 &#39;Ts_k&#39;: 287.8993578570325,
 &#39;cos_theta&#39;: 0.8823677669781348,
 &#39;e_0&#39;: 0.9638391815382993}
{&#39;Albedo&#39;: 0.1889383608586941,
 &#39;Elev_m&#39;: 46,
 &#39;G&#39;: 82.97095770834201,
 &#39;LAI&#39;: 1.522038027424773,
 &#39;NDVI&#39;: 0.7413954404451228,
 &#39;R_n&#39;: 631.2034439339866,
 &#39;SAVI&#39;: 0.5423170225656415,
 &#39;Slope_d&#39;: 0,
 &#39;T_sw&#39;: 0.7579039107647978,
 &#39;Ts_c&#39;: 14.64788019191542,
 &#39;Ts_k&#39;: 287.7978801919154,
 &#39;cos_theta&#39;: 0.8599662614294261,
 &#39;e_0&#39;: 0.9652203802742477}
{&#39;Albedo&#39;: 0.18764806276597423,
 &#39;Elev_m&#39;: 48,
 &#39;G&#39;: 85.87011074696069,
 &#39;LAI&#39;: 1.4394047963216616,
 &#39;NDVI&#39;: 0.7248427672955976,
 &#39;R_n&#39;: 635.924438852567,
 &#39;SAVI&#39;: 0.5307836176623388,
 &#39;Slope_d&#39;: 0.9274099469184875,
 &#39;T_sw&#39;: 0.7587697139964282,
 &#39;Ts_c&#39;: 14.30309411351692,
 &#39;Ts_k&#39;: 287.4530941135169,
 &#39;cos_theta&#39;: 0.8627408519735443,
 &#39;e_0&#39;: 0.9643940479632166}
{&#39;Albedo&#39;: 0.18897750503849803,
 &#39;Elev_m&#39;: 46,
 &#39;G&#39;: 88.85279863452071,
 &#39;LAI&#39;: 1.3650278755962308,
 &#39;NDVI&#39;: 0.7079827822343964,
 &#39;R_n&#39;: 642.038799855443,
 &#39;SAVI&#39;: 0.5196343226495117,
 &#39;Slope_d&#39;: 1.3158215284347534,
 &#39;T_sw&#39;: 0.7593131580480463,
 &#39;Ts_c&#39;: 14.06757766935425,
 &#39;Ts_k&#39;: 287.2175776693542,
 &#39;cos_theta&#39;: 0.870445334975798,
 &#39;e_0&#39;: 0.9636502787559622}
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Coordenadas previamente seleccionados (Pixel Frio)</span>
<span class="n">list_coords_pixf</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">[</span><span class="o">-</span><span class="mf">79.775487</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.601604</span><span class="p">],</span>  <span class="c1"># 0 &#39;2022-01-13&#39; n1: 50 n2: 10</span>
    <span class="p">[</span><span class="o">-</span><span class="mf">79.785809</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.598078</span><span class="p">],</span>  <span class="c1"># 1 &#39;2022-01-29&#39; n1: 50 n2: 10</span>
    <span class="p">[</span><span class="o">-</span><span class="mf">79.782536</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.601574</span><span class="p">],</span>  <span class="c1"># 2 &#39;2022-03-10&#39; n1: 50 n2: 5</span>
    <span class="p">[</span><span class="o">-</span><span class="mf">79.778468</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.603759</span><span class="p">],</span> <span class="c1"># 3 &#39;2022-04-03&#39; n1: 80 n2: 10</span>
    <span class="p">[</span><span class="o">-</span><span class="mf">79.782006</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.598379</span><span class="p">],</span> <span class="c1"># 4 &#39;2022-05-05&#39; n1: 40 n2: 10</span>
    <span class="p">[</span><span class="o">-</span><span class="mf">79.778718</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.604593</span><span class="p">],</span> <span class="c1"># 5 &#39;2022-05-21&#39; n1: 50 n2: 10</span>
    <span class="p">[</span><span class="o">-</span><span class="mf">79.778739</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.604574</span><span class="p">],</span> <span class="c1"># 6 &#39;2022-06-14&#39; n1: 50 n2: 5</span>
<span class="p">]</span>

<span class="c1"># Coordenadas previamente seleccionados (Pixel Caliente)</span>
<span class="n">list_coords_pixc</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">[</span><span class="o">-</span><span class="mf">79.778176</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.605123</span><span class="p">],</span>  <span class="c1"># 0 &#39;2022-01-13&#39; n1: 50 n2: 10</span>
    <span class="p">[</span><span class="o">-</span><span class="mf">79.778717</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.604576</span><span class="p">],</span>  <span class="c1"># 1 &#39;2022-01-29&#39; n1: 50 n2: 10</span>
    <span class="p">[</span><span class="o">-</span><span class="mf">79.778736</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.604317</span><span class="p">],</span>  <span class="c1"># 2 &#39;2022-03-10&#39; n1: 50 n2: 5</span>
    <span class="p">[</span><span class="o">-</span><span class="mf">79.782545</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.601342</span><span class="p">],</span>  <span class="c1"># 3 &#39;2022-04-03&#39; n1: 80 n2: 10</span>
    <span class="p">[</span><span class="o">-</span><span class="mf">79.778744</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.604585</span><span class="p">],</span> <span class="c1"># 4 &#39;2022-05-05&#39; n1: 40 n2: 10</span>
    <span class="p">[</span><span class="o">-</span><span class="mf">79.78228</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.596453</span><span class="p">],</span> <span class="c1"># 5 &#39;2022-05-21&#39; n1: 50 n2: 10</span>
    <span class="p">[</span><span class="o">-</span><span class="mf">79.784462</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.59621</span><span class="p">],</span> <span class="c1"># 6 &#39;2022-06-14&#39; n1: 50 n2: 5</span>
<span class="p">]</span>

<span class="c1"># list_coords_pixf = [</span>
<span class="c1">#     [-79.78527, -6.598056],  # 0 &#39;2022-01-13&#39; n1: 50 n2: 10</span>
<span class="c1">#     [-79.78472, -6.598345],  # 1 &#39;2022-01-29&#39; n1: 50 n2: 10</span>
<span class="c1">#     [-79.78445, -6.596984],  # 2 &#39;2022-03-10&#39; n1: 50 n2: 5</span>
<span class="c1">#     [-79.779022, -6.597242], # 3 &#39;2022-04-03&#39; n1: 80 n2: 10</span>
<span class="c1">#     [-79.776047, -6.597519], # 4 &#39;2022-05-05&#39; n1: 40 n2: 10</span>
<span class="c1">#     [-79.778976, -6.605092], # 5 &#39;2022-05-21&#39; n1: 50 n2: 10</span>
<span class="c1">#     [-79.778737, -6.604828], # 6 &#39;2022-06-14&#39; n1: 50 n2: 5</span>
<span class="c1"># ]</span>

<span class="n">pixf_coord</span> <span class="o">=</span> <span class="n">list_coords_pixf</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
<span class="n">pixf_ee_coord</span> <span class="o">=</span> <span class="n">ee</span><span class="o">.</span><span class="n">Geometry</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span><span class="n">pixf_coord</span><span class="p">)</span>

<span class="n">pix_c_values</span> <span class="o">=</span> <span class="n">get_pixel_values</span><span class="p">(</span><span class="n">pixf_ee_coord</span><span class="p">,</span> <span class="n">d2</span><span class="p">,</span> <span class="n">img_productos</span><span class="p">)</span>

<span class="n">display</span><span class="p">(</span><span class="n">pix_c_values</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;Albedo&#39;: 0.14419593049091683,
 &#39;Elev_m&#39;: 44,
 &#39;G&#39;: 90.32934668718602,
 &#39;LAI&#39;: 0.471268393890954,
 &#39;NDVI&#39;: 0.509179839795846,
 &#39;R_n&#39;: 653.2231837800008,
 &#39;SAVI&#39;: 0.30575963839063286,
 &#39;Slope_d&#39;: 0.9274099469184875,
 &#39;T_sw&#39;: 0.737355258904794,
 &#39;Ts_c&#39;: 19.699221805369973,
 &#39;Ts_k&#39;: 292.84922180536995,
 &#39;cos_theta&#39;: 0.8391784430663471,
 &#39;e_0&#39;: 0.9547126839389095}
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 1. Inputs para gráfico con geemap</span>
<span class="n">paleta</span> <span class="o">=</span> <span class="s1">&#39;RdYlBu_r&#39;</span>  <span class="c1"># Rampa de color azul y rojo</span>
<span class="c1"># paleta = &#39;binary_r&#39;  # Color negro indica el pixel más frío</span>

<span class="n">vis_params_pix</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;min&#39;</span><span class="p">:</span> <span class="n">pixeles_frios_stats</span><span class="p">[</span><span class="s1">&#39;min&#39;</span><span class="p">][</span><span class="s1">&#39;Ts_C&#39;</span><span class="p">],</span>
    <span class="s1">&#39;max&#39;</span><span class="p">:</span> <span class="n">pixeles_frios_stats</span><span class="p">[</span><span class="s1">&#39;max&#39;</span><span class="p">][</span><span class="s1">&#39;Ts_C&#39;</span><span class="p">],</span>
    <span class="s1">&#39;palette&#39;</span><span class="p">:</span> <span class="n">cmp</span><span class="o">.</span><span class="n">get_palette</span><span class="p">(</span><span class="n">paleta</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">image</span> <span class="o">=</span> <span class="n">pixeles_frios_C</span><span class="o">.</span><span class="n">blend</span><span class="p">(</span><span class="n">predios_vis</span><span class="p">)</span>
<span class="n">title_map</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;Pixel Frío - </span><span class="si">{</span><span class="n">fecha</span><span class="si">}</span><span class="s1">&#39;</span>

<span class="n">get_grafica_cartoee_color</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> 
                          <span class="n">vis_params_pix</span><span class="p">,</span> 
                          <span class="n">title_map</span><span class="o">=</span><span class="n">title_map</span><span class="p">,</span>
                          <span class="n">text</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;n1: </span><span class="si">{</span><span class="n">perc_ndvi</span><span class="si">}</span><span class="se">\n</span><span class="s1">n2: </span><span class="si">{</span><span class="n">perc_temp</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
                          <span class="n">nogrid</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                          <span class="n">label</span><span class="o">=</span><span class="s2">&quot;  T [°C]&quot;</span><span class="p">,</span>
                          <span class="n">save_fig</span><span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;imagenes/</span><span class="si">{</span><span class="n">fecha</span><span class="si">}</span><span class="s1">_Pix_F&#39;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/3d9dacef967e8d41dfd204f2ca154db2e28c7c7e1da3ed796882ea431e330729.png" src="_images/3d9dacef967e8d41dfd204f2ca154db2e28c7c7e1da3ed796882ea431e330729.png" />
</div>
</div>
</section>
<section id="pixeles-calientes">
<h3><span class="section-number">4.3.4. </span>Pixeles Calientes<a class="headerlink" href="#pixeles-calientes" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>The “hot” pixel should be located in a dry and bare agricultural field where one can
assume there is no evapotranspiration taking place.</p></li>
<li><p>It is recommended that one no use:</p>
<ul>
<li><p>a hot desert area</p></li>
<li><p>an asphalt parking lot</p></li>
<li><p>a roof</p></li>
<li><p>a south facing mountain slope</p></li>
<li><p>or other such extremely hot areas
since the relationship between dT and Ts may not
follow the same linear relation as for agricultural and bare agricultural soils.ils.</p></li>
</ul>
</li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Selección de Pixel Caliente - Recorte de mapas</span>

<span class="c1"># 0 &#39;2022-01-13&#39; n1: 40 n2: 97</span>
<span class="c1"># 1 &#39;2022-01-29&#39; n1: 10 n2: 90</span>
<span class="c1"># 2 &#39;2022-03-10&#39; n1: 4  n2: 75 </span>
<span class="c1"># 3 &#39;2022-04-03&#39; n1: 10 n2: 80</span>
<span class="c1"># 4 &#39;2022-05-05&#39; n1: 25 n2: 75</span>
<span class="c1"># 5 &#39;2022-05-21&#39; n1: 30 n2: 80</span>
<span class="c1"># 6 &#39;2022-06-14&#39; n1: 10 n2: 80</span>

<span class="n">perc_ndvi</span> <span class="o">=</span> <span class="mi">40</span>  <span class="c1"># n1 : Percentil para NDVI</span>
<span class="n">perc_temp</span> <span class="o">=</span> <span class="mi">97</span>  <span class="c1"># n2 : Percentil para temperatura</span>

<span class="n">pixeles_hot_K</span> <span class="o">=</span> <span class="n">recorte_por_percentiles</span><span class="p">(</span><span class="n">perc_ndvi</span><span class="p">,</span> 
                                        <span class="n">perc_temp</span><span class="p">,</span> 
                                        <span class="n">img_ndvi</span><span class="p">,</span> <span class="n">img_tempK</span><span class="p">,</span> 
                                        <span class="n">geometry</span><span class="o">=</span><span class="n">predios_agricolas</span><span class="p">)</span> <span class="c1"># [K]</span>
<span class="n">pixeles_hot_C</span> <span class="o">=</span> <span class="n">pixeles_hot_K</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="mf">273.15</span><span class="p">)</span> <span class="c1"># [°C]</span>

<span class="n">pixeles_hot_stats</span> <span class="o">=</span> <span class="n">get_stats</span><span class="p">(</span><span class="n">pixeles_hot_C</span><span class="p">,</span> <span class="n">predios_agricolas</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
<span class="c1"># display(pd.DataFrame.from_dict(pixeles_hot_stats, orient=&#39;index&#39;))</span>

<span class="c1"># Obtener gráfica con cartoee</span>
<span class="n">paleta</span> <span class="o">=</span> <span class="s1">&#39;RdYlBu_r&#39;</span> <span class="c1"># RdYlBu_r o binary_r # Color negro o rojo el pixel más caliente</span>

<span class="n">vis_params_pix</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;min&#39;</span><span class="p">:</span> <span class="n">pixeles_hot_stats</span><span class="p">[</span><span class="s1">&#39;min&#39;</span><span class="p">][</span><span class="s1">&#39;Ts_k&#39;</span><span class="p">],</span>
    <span class="s1">&#39;max&#39;</span><span class="p">:</span> <span class="n">pixeles_hot_stats</span><span class="p">[</span><span class="s1">&#39;max&#39;</span><span class="p">][</span><span class="s1">&#39;Ts_k&#39;</span><span class="p">],</span>
    <span class="s1">&#39;palette&#39;</span><span class="p">:</span> <span class="n">cmp</span><span class="o">.</span><span class="n">get_palette</span><span class="p">(</span><span class="n">paleta</span><span class="p">)</span> 
<span class="p">}</span>

<span class="nb">print</span><span class="p">(</span><span class="n">lista_imgprocesadas</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="s1">&#39;fecha&#39;</span><span class="p">])</span>
<span class="n">image</span> <span class="o">=</span> <span class="n">pixeles_hot_C</span><span class="o">.</span><span class="n">blend</span><span class="p">(</span><span class="n">predios_vis</span><span class="p">)</span> <span class="c1"># predios_vis, ee_RectangleVis</span>

<span class="c1"># Visualización</span>
<span class="n">Map</span> <span class="o">=</span> <span class="n">geemap</span><span class="o">.</span><span class="n">Map</span><span class="p">()</span>
<span class="n">Map</span><span class="o">.</span><span class="n">centerObject</span><span class="p">(</span><span class="n">predios_agricolas</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">Map</span><span class="o">.</span><span class="n">addLayer</span><span class="p">(</span><span class="n">img_rgb</span><span class="p">,</span> <span class="n">vis_rgb</span><span class="p">,</span> <span class="s1">&#39;RGB TOA&#39;</span><span class="p">)</span>

<span class="n">Map</span><span class="o">.</span><span class="n">addLayer</span><span class="p">(</span><span class="n">img_albedo</span><span class="p">,</span> <span class="n">vis_params_alb</span><span class="p">,</span> <span class="s1">&#39;albedo&#39;</span><span class="p">)</span>
<span class="n">Map</span><span class="o">.</span><span class="n">addLayer</span><span class="p">(</span><span class="n">img_tempC</span><span class="p">,</span> <span class="n">vis_params_ts</span><span class="p">,</span> <span class="s1">&#39;img_tempC&#39;</span><span class="p">)</span>
<span class="n">Map</span><span class="o">.</span><span class="n">addLayer</span><span class="p">(</span><span class="n">img_ndvi</span><span class="p">,</span> <span class="n">vis_params_ndvi</span><span class="p">,</span> <span class="s1">&#39;img_ndvi&#39;</span><span class="p">)</span>
<span class="n">Map</span><span class="o">.</span><span class="n">addLayer</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">vis_params_pix</span><span class="p">,</span> <span class="s1">&#39;Pixeles C&#39;</span><span class="p">)</span>
<span class="n">Map</span><span class="o">.</span><span class="n">addLayer</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">vis_params_pix</span><span class="p">,</span> <span class="s1">&#39;Pixeles C&#39;</span><span class="p">)</span>

<span class="n">vis_rgb</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;min&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span> <span class="s1">&#39;max&#39;</span><span class="p">:</span> <span class="mf">0.3</span><span class="p">,</span> <span class="s1">&#39;bands&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;B4&#39;</span><span class="p">,</span> <span class="s1">&#39;B3&#39;</span><span class="p">,</span> <span class="s1">&#39;B2&#39;</span><span class="p">]}</span> 

<span class="n">Map</span><span class="o">.</span><span class="n">addLayer</span><span class="p">(</span><span class="n">ee</span><span class="o">.</span><span class="n">Geometry</span><span class="o">.</span><span class="n">Point</span><span class="p">([</span><span class="o">-</span><span class="mf">79.78527</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.598056</span><span class="p">]),</span> <span class="p">{},</span> <span class="s1">&#39;pixel f&#39;</span><span class="p">)</span>
<span class="n">Map</span><span class="o">.</span><span class="n">addLayer</span><span class="p">(</span><span class="n">ee</span><span class="o">.</span><span class="n">Geometry</span><span class="o">.</span><span class="n">Point</span><span class="p">([</span><span class="o">-</span><span class="mf">79.78198</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.602693</span><span class="p">]),</span> <span class="p">{},</span> <span class="s1">&#39;pixel c&#39;</span><span class="p">)</span>

<span class="c1"># Map.add_colorbar(vis_params_ts,  orientation=&quot;horizontal&quot;, label=&quot;img Ts [°C]&quot;)</span>
<span class="n">Map</span><span class="o">.</span><span class="n">add_colorbar</span><span class="p">(</span><span class="n">vis_params_pix</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;vertical&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Pixeles [°C]&#39;</span><span class="p">)</span>
<span class="n">Map</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-01-13
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "496853d05edd4f03a3f2671ebf3eda1d", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ===================================================================================================</span>
<span class="c1"># Selección de pixel caliente</span>
<span class="c1"># 1. Ubica el pixel caliente en el mapa y coloca un marker con la opción &quot;draw a marker&quot;</span>
<span class="c1"># 2. Una vez ubicado, correr la línea de abajo para obtener sus coordenadas [longitud, latitud]</span>
<span class="c1"># ===================================================================================================</span>

<span class="n">Map</span><span class="o">.</span><span class="n">user_rois</span><span class="o">.</span><span class="n">geometry</span><span class="p">()</span><span class="o">.</span><span class="n">coordinates</span><span class="p">()</span><span class="o">.</span><span class="n">getInfo</span><span class="p">()</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[-79.784448, -6.598642]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">list_coords_pixc</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">[</span><span class="o">-</span><span class="mf">79.78198</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.602693</span><span class="p">],</span>  <span class="c1"># 0 &#39;2022-01-13&#39; n1: 40 n2: 97 </span>
    <span class="p">[</span><span class="o">-</span><span class="mf">79.778464</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.605114</span><span class="p">],</span> <span class="c1"># 1 &#39;2022-01-29&#39; n1: 10 n2: 90</span>
    <span class="p">[</span><span class="o">-</span><span class="mf">79.777924</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.604045</span><span class="p">],</span> <span class="c1"># 2 &#39;2022-03-10&#39; n1: 4 n2: 75 </span>
    <span class="p">[</span><span class="o">-</span><span class="mf">79.778463</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.603747</span><span class="p">],</span> <span class="c1"># 3 &#39;2022-04-03&#39; n1: 10 n2: 80  </span>
    <span class="p">[</span><span class="o">-</span><span class="mf">79.784448</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.598642</span><span class="p">],</span> <span class="c1"># 4 &#39;2022-05-05&#39; n1: 25 n2: 75  </span>
    <span class="p">[</span><span class="o">-</span><span class="mf">79.785537</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.598398</span><span class="p">],</span> <span class="c1"># 5 &#39;2022-05-21&#39; n1: 30 n2: 80  </span>
    <span class="p">[</span><span class="o">-</span><span class="mf">79.784729</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.595629</span><span class="p">],</span> <span class="c1"># 6 &#39;2022-06-14&#39; n1: 10 n2: 80 </span>
<span class="p">]</span>

<span class="n">pixc_coord</span> <span class="o">=</span> <span class="n">list_coords_pixc</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
<span class="n">pixc_ee_coord</span> <span class="o">=</span> <span class="n">ee</span><span class="o">.</span><span class="n">Geometry</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span><span class="n">pixc_coord</span><span class="p">)</span>

<span class="n">pix_h_values</span> <span class="o">=</span> <span class="n">get_pixel_values</span><span class="p">(</span><span class="n">pixc_ee_coord</span><span class="p">,</span> <span class="n">d2</span><span class="p">,</span> <span class="n">img_productos</span><span class="p">)</span>
<span class="n">pix_h_values</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;Albedo&#39;: 0.10083496165600218,
 &#39;Elev_m&#39;: 46,
 &#39;G&#39;: 77.20636444733555,
 &#39;LAI&#39;: 1.7779653414479464,
 &#39;NDVI&#39;: 0.347028613352898,
 &#39;R_n&#39;: 636.5881091422093,
 &#39;SAVI&#39;: 0.17604746587338813,
 &#39;Slope_d&#39;: 1.315826416015625,
 &#39;T_sw&#39;: 0.6733418640731811,
 &#39;Ts_c&#39;: 15.865663895426906,
 &#39;Ts_k&#39;: 289.0156638954269,
 &#39;e_0&#39;: 0.9677796534144795}
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Obtener gráfica con cartoee</span>
<span class="n">paleta</span> <span class="o">=</span> <span class="s1">&#39;RdYlBu_r&#39;</span> <span class="c1"># RdYlBu_r o binary_r # Color negro o rojo el pixel más caliente</span>

<span class="n">vis_params_pix_c</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;min&#39;</span><span class="p">:</span> <span class="n">pixeles_hot_stats</span><span class="p">[</span><span class="s1">&#39;min&#39;</span><span class="p">][</span><span class="s1">&#39;Ts_k&#39;</span><span class="p">],</span>
    <span class="s1">&#39;max&#39;</span><span class="p">:</span> <span class="n">pixeles_hot_stats</span><span class="p">[</span><span class="s1">&#39;max&#39;</span><span class="p">][</span><span class="s1">&#39;Ts_k&#39;</span><span class="p">],</span>
    <span class="s1">&#39;palette&#39;</span><span class="p">:</span> <span class="n">cmp</span><span class="o">.</span><span class="n">get_palette</span><span class="p">(</span><span class="n">paleta</span><span class="p">)</span> 
<span class="p">}</span>

<span class="n">image</span> <span class="o">=</span> <span class="n">pixeles_hot_C</span><span class="o">.</span><span class="n">blend</span><span class="p">(</span><span class="n">predios_vis</span><span class="p">)</span> 
<span class="n">title_map</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;Pixel Caliente - </span><span class="si">{</span><span class="n">fecha</span><span class="si">}</span><span class="s1">&#39;</span>

<span class="n">get_grafica_cartoee_color</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> 
                          <span class="n">vis_params_pix_c</span><span class="p">,</span> 
                          <span class="n">title_map</span><span class="o">=</span><span class="n">title_map</span><span class="p">,</span>
                          <span class="n">text</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;n1: </span><span class="si">{</span><span class="n">perc_ndvi</span><span class="si">}</span><span class="se">\n</span><span class="s1">n2: </span><span class="si">{</span><span class="n">perc_temp</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
                          <span class="n">nogrid</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                          <span class="n">label</span><span class="o">=</span><span class="s2">&quot;  T [°C]&quot;</span><span class="p">,</span>
                          <span class="n">save_fig</span><span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;imagenes/</span><span class="si">{</span><span class="n">fecha</span><span class="si">}</span><span class="s1">_Pix_C&#39;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/3a1b17d089a6c54ec9a16bc8e036668632f0b433b0d115b00bd838dc9c9d525d.png" src="_images/3a1b17d089a6c54ec9a16bc8e036668632f0b433b0d115b00bd838dc9c9d525d.png" />
</div>
</div>
</section>
<section id="pruebas">
<h3><span class="section-number">4.3.5. </span>Pruebas<a class="headerlink" href="#pruebas" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># # Selección de Pixel Frío - Recorte de mapas (temperaturas y ndvi)</span>

<span class="c1"># # 0 &#39;2022-01-13&#39; n1: 50 n2: 10</span>
<span class="c1"># # 1 &#39;2022-01-29&#39; n1: 50 n2: 10</span>
<span class="c1"># # 2 &#39;2022-03-10&#39; n1: 50 n2: 5</span>
<span class="c1"># # 3 &#39;2022-04-03&#39; n1: 80 n2: 10</span>
<span class="c1"># # 4 &#39;2022-05-05&#39; n1: 40 n2: 10</span>
<span class="c1"># # 5 &#39;2022-05-21&#39; n1: 50 n2: 10</span>
<span class="c1"># # 6 &#39;2022-06-14&#39; n1: 50 n2: 5</span>

<span class="c1"># perc_ndvi =  50  # n1: Percentil para NDVI</span>
<span class="c1"># perc_temp =  10  # n2: Percentil para temperatura</span>

<span class="c1"># # Procesado de imagen</span>
<span class="c1"># pixeles_frios_K = recorte_por_percentiles(perc_ndvi, perc_temp, </span>
<span class="c1">#                                           img_ndvi, img_tempK, geometry=predios_agricolas, </span>
<span class="c1">#                                           filtrado=&#39;cold&#39;) # [K]</span>
<span class="c1"># pixeles_frios_C = pixeles_frios_K.subtract(273.15).rename(&#39;Ts_C&#39;) # [°C]</span>

<span class="c1"># # Estadisticas</span>
<span class="c1"># pixeles_frios_stats = get_stats(pixeles_frios_C, predios_agricolas, 30)</span>

<span class="c1"># # =============================================================</span>
<span class="c1"># # Visualizar</span>
<span class="c1"># # ============================================================= </span>

<span class="c1"># # 1. Inputs para gráfico con geemap</span>
<span class="c1"># paleta = &#39;RdYlBu_r&#39;  # Rampa de color azul y rojo</span>
<span class="c1"># # paleta = &#39;binary_r&#39;  # Color negro indica el pixel más frío</span>

<span class="c1"># vis_params_pix = {</span>
<span class="c1">#     &#39;min&#39;: pixeles_frios_stats[&#39;min&#39;][&#39;Ts_C&#39;],</span>
<span class="c1">#     &#39;max&#39;: pixeles_frios_stats[&#39;max&#39;][&#39;Ts_C&#39;],</span>
<span class="c1">#     &#39;palette&#39;: cmp.get_palette(paleta)</span>
<span class="c1"># }</span>

<span class="c1"># image = pixeles_frios_C.blend(predios_vis)</span>

<span class="c1"># print(lista_imgprocesadas[index][&#39;fecha&#39;])</span>

<span class="c1"># # 2. Visualización con geemap</span>
<span class="c1"># Map = geemap.Map()</span>
<span class="c1"># Map.centerObject(predios_agricolas, 16)</span>

<span class="c1"># Map.addLayer(img_rgb, vis_rgb, &#39;RGB TOA&#39;)</span>
<span class="c1"># Map.addLayer(img_tempC, vis_params_ts, &#39;img Ts °C&#39;)</span>
<span class="c1"># Map.addLayer(img_ndvi, vis_params_ndvi, &#39;img_ndvi&#39;)</span>
<span class="c1"># Map.addLayer(image, vis_params_pix, &#39;Pixeles&#39;)</span>

<span class="c1"># Map.addLayer(ee.Geometry.Point([-79.778976, -6.605092]), {}, &#39;Pixel&#39;)</span>

<span class="c1"># Map.add_colorbar(vis_params_pix, orientation=&#39;vertical&#39;, label=&#39;Pixeles [°C]&#39;)</span>
<span class="c1"># Map</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Coordenadas previamente seleccionados (Pixel Frio)</span>
<span class="n">list_coords_pixf</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">[</span><span class="o">-</span><span class="mf">79.78527</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.598056</span><span class="p">],</span>  <span class="c1"># 0 &#39;2022-01-13&#39; n1: 50 n2: 10</span>
    <span class="p">[</span><span class="o">-</span><span class="mf">79.78472</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.598345</span><span class="p">],</span>  <span class="c1"># 1 &#39;2022-01-29&#39; n1: 50 n2: 10</span>
    <span class="p">[</span><span class="o">-</span><span class="mf">79.78445</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.596984</span><span class="p">],</span>  <span class="c1"># 2 &#39;2022-03-10&#39; n1: 50 n2: 5</span>
    <span class="p">[</span><span class="o">-</span><span class="mf">79.779022</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.597242</span><span class="p">],</span> <span class="c1"># 3 &#39;2022-04-03&#39; n1: 80 n2: 10</span>
    <span class="p">[</span><span class="o">-</span><span class="mf">79.776047</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.597519</span><span class="p">],</span> <span class="c1"># 4 &#39;2022-05-05&#39; n1: 40 n2: 10</span>
    <span class="p">[</span><span class="o">-</span><span class="mf">79.778976</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.605092</span><span class="p">],</span> <span class="c1"># 5 &#39;2022-05-21&#39; n1: 50 n2: 10</span>
    <span class="p">[</span><span class="o">-</span><span class="mf">79.778737</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.604828</span><span class="p">],</span> <span class="c1"># 6 &#39;2022-06-14&#39; n1: 50 n2: 5</span>
<span class="p">]</span>

<span class="n">pixf_coord</span> <span class="o">=</span> <span class="n">list_coords_pixf</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
<span class="n">pixf_ee_coord</span> <span class="o">=</span> <span class="n">ee</span><span class="o">.</span><span class="n">Geometry</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span><span class="n">pixf_coord</span><span class="p">)</span>

<span class="n">pix_c_values</span> <span class="o">=</span> <span class="n">get_pixel_values</span><span class="p">(</span><span class="n">pixf_ee_coord</span><span class="p">,</span> <span class="n">d2</span><span class="p">,</span> <span class="n">img_productos</span><span class="p">)</span>

<span class="n">display</span><span class="p">(</span><span class="n">pix_c_values</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="graficas">
<h3><span class="section-number">4.3.6. </span>Gráficas<a class="headerlink" href="#graficas" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">index</span> <span class="o">=</span> <span class="mi">3</span> <span class="c1"># 0 1 Enero, 2 Marzo, 3 Junio </span>

<span class="n">img_productos</span> <span class="o">=</span> <span class="n">lista_imgprocesadas</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="s1">&#39;img_productos&#39;</span><span class="p">]</span>

<span class="n">fecha</span> <span class="o">=</span> <span class="n">lista_imgprocesadas</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="s1">&#39;fecha&#39;</span><span class="p">]</span>
<span class="c1"># img_productos.clip(predios_agricolas)</span>

<span class="n">d2</span> <span class="o">=</span> <span class="n">lista_imgprocesadas</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="s1">&#39;d2&#39;</span><span class="p">]</span>
<span class="n">img_ndvi</span> <span class="o">=</span> <span class="n">img_productos</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;NDVI&#39;</span><span class="p">)</span>
<span class="n">img_savi</span> <span class="o">=</span> <span class="n">img_productos</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;SAVI&#39;</span><span class="p">)</span>
<span class="n">img_lai</span>  <span class="o">=</span> <span class="n">img_productos</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;LAI&#39;</span><span class="p">)</span>
<span class="n">img_albedo</span> <span class="o">=</span> <span class="n">img_productos</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;albedo&#39;</span><span class="p">)</span>
<span class="n">img_tempC</span> <span class="o">=</span> <span class="n">img_productos</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;Ts_c&#39;</span><span class="p">)</span>
<span class="n">img_tempK</span> <span class="o">=</span> <span class="n">img_productos</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;Ts_k&#39;</span><span class="p">)</span>
<span class="n">img_slope</span> <span class="o">=</span> <span class="n">img_productos</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;slope&#39;</span><span class="p">)</span>

<span class="n">cos_theta_rel</span> <span class="o">=</span> <span class="n">img_productos</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;cos_theta&#39;</span><span class="p">)</span>
<span class="n">t_sw</span> <span class="o">=</span> <span class="n">img_productos</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;t_sw&#39;</span><span class="p">)</span>
<span class="n">e_0</span>  <span class="o">=</span> <span class="n">img_productos</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;e_0&#39;</span><span class="p">)</span>

<span class="c1"># Estadísticas</span>
<span class="n">img_productos_dict</span> <span class="o">=</span> <span class="n">get_stats</span><span class="p">(</span><span class="n">img_productos</span><span class="p">,</span> <span class="n">predios_agricolas</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
<span class="n">img_productos_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">img_productos_dict</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">)</span> <span class="c1"># .round(3)</span>
<span class="n">display</span><span class="p">(</span><span class="n">img_productos_df</span><span class="p">)</span>

<span class="n">vis_params_ndvi</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;min&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.2</span><span class="p">,</span> <span class="c1"># img_productos_dict[&#39;min&#39;][&#39;NDVI&#39;],</span>
    <span class="s1">&#39;max&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>    <span class="c1"># img_productos_dict[&#39;max&#39;][&#39;NDVI&#39;],</span>
    <span class="s1">&#39;palette&#39;</span><span class="p">:</span> <span class="n">ndvi_cmap</span> <span class="c1"># cmp.get_palette(&#39;RdYlGn&#39;)</span>
<span class="p">}</span>

<span class="n">vis_params_savi</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;min&#39;</span><span class="p">:</span> <span class="n">img_productos_dict</span><span class="p">[</span><span class="s1">&#39;min&#39;</span><span class="p">][</span><span class="s1">&#39;SAVI&#39;</span><span class="p">],</span>
    <span class="s1">&#39;max&#39;</span><span class="p">:</span> <span class="n">img_productos_dict</span><span class="p">[</span><span class="s1">&#39;max&#39;</span><span class="p">][</span><span class="s1">&#39;SAVI&#39;</span><span class="p">],</span>
    <span class="s1">&#39;palette&#39;</span><span class="p">:</span> <span class="n">ndvi_cmap</span> <span class="c1"># cmp.get_palette(&#39;RdYlGn&#39;)</span>
<span class="p">}</span>

<span class="n">vis_params_alb</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;min&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s1">&#39;max&#39;</span><span class="p">:</span> <span class="mf">0.25</span><span class="p">,</span>
    <span class="s1">&#39;palette&#39;</span><span class="p">:</span> <span class="n">cmp</span><span class="o">.</span><span class="n">get_palette</span><span class="p">(</span><span class="s1">&#39;cubehelix&#39;</span><span class="p">)</span> 
<span class="p">}</span>

<span class="n">vis_params_ts</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;min&#39;</span><span class="p">:</span> <span class="n">img_productos_dict</span><span class="p">[</span><span class="s1">&#39;min&#39;</span><span class="p">][</span><span class="s1">&#39;Ts_c&#39;</span><span class="p">],</span>
    <span class="s1">&#39;max&#39;</span><span class="p">:</span> <span class="n">img_productos_dict</span><span class="p">[</span><span class="s1">&#39;max&#39;</span><span class="p">][</span><span class="s1">&#39;Ts_c&#39;</span><span class="p">],</span>
    <span class="s1">&#39;palette&#39;</span><span class="p">:</span><span class="n">cmp</span><span class="o">.</span><span class="n">get_palette</span><span class="p">(</span><span class="s1">&#39;RdYlBu_r&#39;</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">vis_params_lai</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;min&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>  
    <span class="s1">&#39;max&#39;</span><span class="p">:</span> <span class="n">img_productos_dict</span><span class="p">[</span><span class="s1">&#39;max&#39;</span><span class="p">][</span><span class="s1">&#39;LAI&#39;</span><span class="p">],</span> 
    <span class="s1">&#39;palette&#39;</span><span class="p">:</span> <span class="n">cmp</span><span class="o">.</span><span class="n">get_palette</span><span class="p">(</span><span class="s1">&#39;cubehelix_r&#39;</span><span class="p">)</span> <span class="c1"># RdYlGn_r, afmhot, turbo_r</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>LAI</th>
      <th>NDVI</th>
      <th>SAVI</th>
      <th>Ts_c</th>
      <th>Ts_k</th>
      <th>albedo</th>
      <th>cos_theta</th>
      <th>e_0</th>
      <th>e_NB</th>
      <th>elevation</th>
      <th>slope</th>
      <th>t_sw</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>max</th>
      <td>2.463521</td>
      <td>0.564996</td>
      <td>0.374299</td>
      <td>31.605628</td>
      <td>304.755628</td>
      <td>0.314653</td>
      <td>0.807201</td>
      <td>0.974635</td>
      <td>0.978130</td>
      <td>54.000000</td>
      <td>6.230337</td>
      <td>0.659318</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>1.699559</td>
      <td>0.264333</td>
      <td>0.169094</td>
      <td>28.373553</td>
      <td>301.523553</td>
      <td>0.190869</td>
      <td>0.766321</td>
      <td>0.966996</td>
      <td>0.975609</td>
      <td>46.121525</td>
      <td>1.692146</td>
      <td>0.659183</td>
    </tr>
    <tr>
      <th>median</th>
      <td>1.669874</td>
      <td>0.278310</td>
      <td>0.188720</td>
      <td>27.978548</td>
      <td>301.138559</td>
      <td>0.192801</td>
      <td>0.764497</td>
      <td>0.966705</td>
      <td>0.975517</td>
      <td>46.000000</td>
      <td>1.860307</td>
      <td>0.659183</td>
    </tr>
    <tr>
      <th>min</th>
      <td>1.608074</td>
      <td>0.085178</td>
      <td>0.035070</td>
      <td>23.808969</td>
      <td>296.958969</td>
      <td>0.085689</td>
      <td>0.723844</td>
      <td>0.966081</td>
      <td>0.975307</td>
      <td>40.000000</td>
      <td>0.000000</td>
      <td>0.659058</td>
    </tr>
    <tr>
      <th>mode</th>
      <td>1.608493</td>
      <td>0.286231</td>
      <td>0.206115</td>
      <td>26.891828</td>
      <td>300.043907</td>
      <td>0.202663</td>
      <td>0.763783</td>
      <td>0.966093</td>
      <td>0.975308</td>
      <td>45.000000</td>
      <td>0.930368</td>
      <td>0.659181</td>
    </tr>
    <tr>
      <th>stdDev</th>
      <td>0.131976</td>
      <td>0.089286</td>
      <td>0.065265</td>
      <td>1.620770</td>
      <td>1.620770</td>
      <td>0.042765</td>
      <td>0.014448</td>
      <td>0.001320</td>
      <td>0.000436</td>
      <td>2.046017</td>
      <td>0.960372</td>
      <td>0.000038</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Pixel frio</span>
<span class="c1"># 0 &#39;2022-01-13&#39; n1: 50 n2: 10</span>
<span class="c1"># 1 &#39;2022-01-29&#39; n1: 50 n2: 10</span>
<span class="c1"># 2 &#39;2022-03-10&#39; n1: 50 n2: 5</span>
<span class="c1"># 3 &#39;2022-06-14&#39; n1: 50 n2: 5</span>

<span class="c1"># Selección de Pixel Frío - Recorte de mapas</span>
<span class="n">perc_ndvi</span> <span class="o">=</span>  <span class="mi">50</span>  <span class="c1"># n1 : Percentil para NDVI</span>
<span class="n">perc_temp</span> <span class="o">=</span>  <span class="mi">5</span>   <span class="c1"># n2 : Percentil para temperatura</span>

<span class="c1"># Procesado de imagen</span>
<span class="n">pixeles_f_K</span> <span class="o">=</span> <span class="n">recorte_por_percentiles</span><span class="p">(</span><span class="n">perc_ndvi</span><span class="p">,</span> 
                                      <span class="n">perc_temp</span><span class="p">,</span> 
                                      <span class="n">img_ndvi</span><span class="p">,</span> 
                                      <span class="n">img_tempK</span><span class="p">,</span> 
                                      <span class="n">geometry</span><span class="o">=</span><span class="n">predios_agricolas</span><span class="p">,</span> 
                                      <span class="n">filtrado</span><span class="o">=</span><span class="s1">&#39;cold&#39;</span><span class="p">)</span> <span class="c1"># [K]</span>
<span class="n">pixeles_f_C</span> <span class="o">=</span> <span class="n">pixeles_f_K</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="mf">273.15</span><span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s1">&#39;Ts_C&#39;</span><span class="p">)</span> <span class="c1"># [°C]</span>
<span class="n">pixeles_f_stats</span> <span class="o">=</span> <span class="n">get_stats</span><span class="p">(</span><span class="n">pixeles_f_C</span><span class="p">,</span> <span class="n">predios_agricolas</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>

<span class="c1"># Pixel caliente</span>
<span class="c1"># 0 &#39;2022-01-13&#39; n1: 40 n2: 97</span>
<span class="c1"># 1 &#39;2022-01-29&#39; n1: 50 n2: 70</span>
<span class="c1"># 2 &#39;2022-03-10&#39; n1: 4 n2: 80 </span>
<span class="c1"># 3 &#39;2022-06-14&#39; n1: 10 n2: 80</span>

<span class="c1"># Selección de Pixel Caliente - Recorte de mapas</span>
<span class="n">perc_ndvi</span> <span class="o">=</span> <span class="mi">10</span>  <span class="c1"># n1 : Percentil para NDVI</span>
<span class="n">perc_temp</span> <span class="o">=</span> <span class="mi">80</span> <span class="c1"># n2 : Percentil para temperatura</span>

<span class="n">pixeles_c_K</span> <span class="o">=</span> <span class="n">recorte_por_percentiles</span><span class="p">(</span><span class="n">perc_ndvi</span><span class="p">,</span> 
                                        <span class="n">perc_temp</span><span class="p">,</span> 
                                        <span class="n">img_ndvi</span><span class="p">,</span> 
                                        <span class="n">img_tempK</span><span class="p">,</span> 
                                        <span class="n">geometry</span><span class="o">=</span><span class="n">predios_agricolas</span><span class="p">)</span> <span class="c1"># [K]</span>
<span class="n">pixeles_c_C</span> <span class="o">=</span> <span class="n">pixeles_c_K</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="mf">273.15</span><span class="p">)</span> <span class="c1"># [°C]</span>
<span class="n">pixeles_c_stats</span> <span class="o">=</span> <span class="n">get_stats</span><span class="p">(</span><span class="n">pixeles_c_C</span><span class="p">,</span> <span class="n">predios_agricolas</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>

<span class="c1"># 1. Inputs para gráfico con geemap</span>
<span class="n">path</span> <span class="o">=</span> <span class="s1">&#39;imagenes/pixeles&#39;</span>

<span class="c1"># Pixel Frio</span>
<span class="n">paleta</span> <span class="o">=</span> <span class="s1">&#39;RdYlBu_r&#39;</span> <span class="c1"># Rampa de color azul y rojo</span>
<span class="n">vis_params_pixf</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;min&#39;</span><span class="p">:</span> <span class="n">pixeles_f_stats</span><span class="p">[</span><span class="s1">&#39;min&#39;</span><span class="p">][</span><span class="s1">&#39;Ts_C&#39;</span><span class="p">],</span>
    <span class="s1">&#39;max&#39;</span><span class="p">:</span> <span class="n">pixeles_f_stats</span><span class="p">[</span><span class="s1">&#39;max&#39;</span><span class="p">][</span><span class="s1">&#39;Ts_C&#39;</span><span class="p">],</span>
    <span class="s1">&#39;palette&#39;</span><span class="p">:</span> <span class="n">cmp</span><span class="o">.</span><span class="n">get_palette</span><span class="p">(</span><span class="n">paleta</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">image</span> <span class="o">=</span> <span class="n">pixeles_f_C</span><span class="o">.</span><span class="n">blend</span><span class="p">(</span><span class="n">predios_vis</span><span class="p">)</span>
<span class="n">title_map</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;Pixel Frío - </span><span class="si">{</span><span class="n">fecha</span><span class="si">}</span><span class="s1">&#39;</span>

<span class="n">get_grafica_cartoee_color</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> 
                          <span class="n">vis_params_pixf</span><span class="p">,</span> 
                          <span class="n">title_map</span><span class="o">=</span><span class="n">title_map</span><span class="p">,</span>
                          <span class="n">text</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;n1: </span><span class="si">{</span><span class="n">perc_ndvi</span><span class="si">}</span><span class="se">\n</span><span class="s1">n2: </span><span class="si">{</span><span class="n">perc_temp</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
                          <span class="n">nogrid</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                          <span class="n">label</span><span class="o">=</span><span class="s2">&quot;  T [°C]&quot;</span><span class="p">,</span>
                          <span class="n">save_fig</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">fecha</span><span class="si">}</span><span class="s1">_Pix_F&#39;</span>
<span class="p">)</span>

<span class="c1"># Pixel Caliente</span>
<span class="n">paleta</span> <span class="o">=</span> <span class="s1">&#39;RdYlBu_r&#39;</span> <span class="c1"># Color rojo el pixel más caliente</span>
<span class="n">vis_params_pixc</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;min&#39;</span><span class="p">:</span> <span class="n">pixeles_c_stats</span><span class="p">[</span><span class="s1">&#39;min&#39;</span><span class="p">][</span><span class="s1">&#39;Ts_k&#39;</span><span class="p">],</span>
    <span class="s1">&#39;max&#39;</span><span class="p">:</span> <span class="n">pixeles_c_stats</span><span class="p">[</span><span class="s1">&#39;max&#39;</span><span class="p">][</span><span class="s1">&#39;Ts_k&#39;</span><span class="p">],</span>
    <span class="s1">&#39;palette&#39;</span><span class="p">:</span> <span class="n">cmp</span><span class="o">.</span><span class="n">get_palette</span><span class="p">(</span><span class="n">paleta</span><span class="p">)</span> 
<span class="p">}</span>

<span class="n">title_map</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;Pixel Caliente - </span><span class="si">{</span><span class="n">fecha</span><span class="si">}</span><span class="s1">&#39;</span>
<span class="n">image</span> <span class="o">=</span> <span class="n">pixeles_c_C</span><span class="o">.</span><span class="n">blend</span><span class="p">(</span><span class="n">predios_vis</span><span class="p">)</span>

<span class="n">get_grafica_cartoee_color</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> 
                          <span class="n">vis_params_pixc</span><span class="p">,</span> 
                          <span class="n">title_map</span><span class="o">=</span><span class="n">title_map</span><span class="p">,</span>
                          <span class="n">text</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;n1: </span><span class="si">{</span><span class="n">perc_ndvi</span><span class="si">}</span><span class="se">\n</span><span class="s1">n2: </span><span class="si">{</span><span class="n">perc_temp</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
                          <span class="n">nogrid</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                          <span class="n">label</span><span class="o">=</span><span class="s2">&quot;  T [°C]&quot;</span><span class="p">,</span>
                          <span class="n">save_fig</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">fecha</span><span class="si">}</span><span class="s1">_Pix_C&#39;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/23f303012876357baedb8efe7a54cec9d13ea4965a7ae80ddefe8390ba0ea063.png" src="_images/23f303012876357baedb8efe7a54cec9d13ea4965a7ae80ddefe8390ba0ea063.png" />
<img alt="_images/d4140b6799cc7b0d1c1682494991ba128beaaf3cd3ee3422dd2d1370c1c015ec.png" src="_images/d4140b6799cc7b0d1c1682494991ba128beaaf3cd3ee3422dd2d1370c1c015ec.png" />
</div>
</div>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="3_H_Desarrollo.html"
       title="página anterior">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">anterior</p>
        <p class="prev-next-title"><span class="section-number">3. </span>Sección iterativa y parámetro H</p>
      </div>
    </a>
    <a class="right-next"
       href="5_Modelo_METRIC.html"
       title="siguiente página">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">siguiente</p>
        <p class="prev-next-title"><span class="section-number">5. </span>Balance de Energía Superficial - Modelo METRIC</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contenido
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#inicio">4.1. Inicio</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#funcion">4.2. Función</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#procesamiento">4.3. Procesamiento</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#revisando-datos">4.3.1. Revisando datos</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#funcion-recorte-por-percentiles">4.3.2. Función <code class="docutils literal notranslate"><span class="pre">recorte_por_percentiles</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#pixeles-frios">4.3.3. Pixeles Fríos</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#pixeles-calientes">4.3.4. Pixeles Calientes</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#pruebas">4.3.5. Pruebas</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#graficas">4.3.6. Gráficas</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
Por Cesar Vilca - 2024
</p>

  </div>
  
  <div class="footer-item">
    

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
<div class="extra_footer">
  <p>
    <a href="https://github.com/vilcagamarracf">github.com/vilcagamarracf</a>
</p>

</div>
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>